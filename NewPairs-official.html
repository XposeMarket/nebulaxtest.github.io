<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>NEBULAX • New Pairs</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
<script src="nx-theme.js"></script>
<script src="https://unpkg.com/@solana/web3.js@1.95.3/lib/index.iife.min.js"></script>
<script>
  window.NX_RPC = "https://rpc.helius.xyz/?api-key=3858d764-530d-4b75-b3df-619dc2613ff9";
</script>
<script src="assets/nx-wallet.js"></script>
<script>
document.addEventListener("DOMContentLoaded", async () => {
  // Sync profile picture from platform avatar or store state
  function updatePfp() {
    try {
      const pfpImg = document.getElementById('nx-pfp');
      if(!pfpImg) {
        setTimeout(updatePfp, 500);
        return;
      }

      let avatarSrc = localStorage.getItem('nx_platform_avatar');
      if (!avatarSrc) {
        const storeState = JSON.parse(localStorage.getItem('nx_store_state_v3') || '{}');
        avatarSrc = storeState.profile?.avatar;
      }
      if (!avatarSrc) avatarSrc = 'NebulaX-logo.png';
      
      pfpImg.src = avatarSrc;
      pfpImg.onerror = () => { pfpImg.src = 'NebulaX-logo.png'; };
    } catch(e) {
      const pfpImg = document.getElementById('nx-pfp');
      if(pfpImg) pfpImg.src = 'NebulaX-logo.png';
    }
  }
  setTimeout(updatePfp, 100);

  // Listen for avatar changes from store
  window.addEventListener('nebula:avatar:changed', (e) => {
    const pfpImg = document.getElementById('nx-pfp');
    if(pfpImg && e.detail?.avatar) {
      pfpImg.src = e.detail.avatar;
      pfpImg.onerror = () => { pfpImg.src = 'NebulaX-logo.png'; };
    }
  });

  const btn = document.getElementById("wallet-btn");
  function paint(sol){
    if (!btn) return;
    if (sol == null) {
      btn.innerHTML = `<i data-lucide="wallet" class="w-3 h-3 mr-2"></i> Connect Wallet`;
    } else {
      const s = sol.toFixed(3);
      btn.innerHTML = `<i data-lucide="wallet" class="w-3 h-3 mr-2"></i> Bal: ${s} SOL`;
    }
    try { window.lucide?.createIcons?.(); } catch {}
  }
  if (window.NXWallet?.isConnected?.()) {
    try { await window.NXWallet.refreshBalance?.(true); } catch {}
    paint(window.NXWallet?.getBalance?.());
  } else {
    const prov = (window.phantom?.solana) || window.solana;
    try { await prov?.connect?.({ onlyIfTrusted: true }); } catch {}
    if (window.NXWallet?.isConnected?.()) {
      try { await window.NXWallet.refreshBalance?.(true); } catch {}
      paint(window.NXWallet?.getBalance?.());
    } else {
      paint(null);
    }
  }
  window.addEventListener("nebula:sol:changed", (e)=> paint(e.detail?.balance));
  window.addEventListener("nxwallet:connected", async ()=>{
    try { await window.NXWallet.refreshBalance?.(true); } catch {}
    paint(window.NXWallet?.getBalance?.());
  });
  window.addEventListener("nxwallet:disconnected", ()=> paint(null));
  
  // Wallet modal handlers
  const wBtn = document.getElementById('wallet-btn');
  const wModal = document.getElementById('wallet-modal');
  
  function updateWalletDisplay(){
    const balance = window.NXWallet?.getBalance?.();
    const sol = balance ? balance.toFixed(3) : '0.000';
    document.getElementById('wallet-total').textContent = sol + ' SOL';
    document.getElementById('wallet-available').textContent = sol + ' SOL';
  }
  
  wBtn?.addEventListener('click',(e)=>{ e.stopPropagation(); updateWalletDisplay(); wModal.classList.remove('hidden'); });
  wModal?.addEventListener('click',(e)=>{ if(e.target===wModal) wModal.classList.add('hidden'); });
  document.getElementById('dp-open')?.addEventListener('click',()=>{ wModal.classList.add('hidden'); document.getElementById('deposit').classList.remove('hidden'); });
  document.getElementById('wd-open')?.addEventListener('click',()=>{ wModal.classList.add('hidden'); document.getElementById('withdraw').classList.remove('hidden'); });
  
  // Wallet connect/disconnect
  document.getElementById('wallet-connect')?.addEventListener('click',async()=>{ 
    const prov = (window.phantom?.solana) || window.solana;
    try { await prov?.connect?.(); } catch(e) { console.log('Connect cancelled'); }
  });
  document.getElementById('wallet-disconnect')?.addEventListener('click',async()=>{ 
    const prov = (window.phantom?.solana) || window.solana;
    try { await prov?.disconnect?.(); } catch(e) { console.log('Disconnect error'); }
  });
  
  // Deposit address copy
  const copyBtn = document.getElementById('copy-deposit-btn');
  const depositAddr = document.getElementById('deposit-addr');
  copyBtn?.addEventListener('click',()=>{ 
    const addr = depositAddr.textContent;
    navigator.clipboard.writeText(addr).then(()=>{ copyBtn.textContent='Copied!'; setTimeout(()=>{ copyBtn.textContent='Copy Address'; },2000); }); 
  });
  
  // Close modals on click outside
  document.getElementById('deposit')?.addEventListener('click',(e)=>{ if(e.target.id==='deposit') e.target.classList.add('hidden'); });
  document.getElementById('withdraw')?.addEventListener('click',(e)=>{ if(e.target.id==='withdraw') e.target.classList.add('hidden'); });
  
  // Listen for balance changes
  window.addEventListener('nebula:sol:changed',(e)=>{ if(!wModal.classList.contains('hidden')) updateWalletDisplay(); });
});
</script>
<script> window.NX_BIRDEYE_KEY = '267367afba5b44f2b7398e53aba49f5f'; </script>
<!-- in <head>, before your React app runs -->
<script src="nx-theme.js"></script>
<!-- Tiny pre-paint boot so there's no flash -->
<script>
  try {
    const t = JSON.parse(localStorage.getItem('nebula_theme_v1'))?.name;
    if (t) document.documentElement.setAttribute('data-theme', t);
  } catch {}
</script>
    <style>
      :root{
        --nx-cyan:#00e6ff;
        --nx-dark:#0a0d1b;
        --nx-dark-2:#12152a;
        --nx-border:#1e2747;
        --nx-text:#e0e7ff;
        --page-max: 1400px; /* match other pages */
      }
      html,body{height:100%; background:var(--nx-dark); font-family:'Orbitron','ui-monospace','SFMono-Regular',monospace; color:var(--nx-text);}
      .page-wrap{max-width:var(--page-max); margin:18px auto; padding:0 12px;}
      
      /* Themed scrollbar */
      .themed-scroll {
        scrollbar-width: thin;
        scrollbar-color: rgba(0, 230, 255, 0.4) rgba(0, 230, 255, 0.05);
      }
      .themed-scroll::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      .themed-scroll::-webkit-scrollbar-track {
        background: rgba(0, 230, 255, 0.05);
        border-radius: 4px;
      }
      .themed-scroll::-webkit-scrollbar-thumb {
        background: rgba(0, 230, 255, 0.4);
        border-radius: 4px;
      }
      .themed-scroll::-webkit-scrollbar-thumb:hover {
        background: rgba(0, 230, 255, 0.6);
      }

      html[data-theme="amber"] .themed-scroll {
        scrollbar-color: rgba(255, 176, 32, 0.4) rgba(255, 176, 32, 0.05);
      }
      html[data-theme="amber"] .themed-scroll::-webkit-scrollbar-track {
        background: rgba(255, 176, 32, 0.05);
      }
      html[data-theme="amber"] .themed-scroll::-webkit-scrollbar-thumb {
        background: rgba(255, 176, 32, 0.4);
      }
      html[data-theme="amber"] .themed-scroll::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 176, 32, 0.6);
      }

      /* Panels */
      .nx-panel{
        background:rgba(16,20,40,.92);
        border:1px solid var(--nx-border);
        box-shadow: inset 0 0 10px rgba(0,230,255,.18), 0 0 12px rgba(0,230,255,.08);
        backdrop-filter: blur(8px);
        border-radius: 16px;
      }
      .nx-title{color:#ffeb3b;text-shadow:0 0 3px #ffeb3b;}
      .tabnums{font-variant-numeric: tabular-nums;}

      /* Buttons */
      .nx-btn{
        border-radius:14px; padding:.42rem .72rem; font-weight:700;
        transition:transform .05s ease, opacity .18s ease, box-shadow .18s ease;
        border:1px solid var(--nx-border); background:var(--nx-dark-2); color:var(--nx-text);
      }
      .nx-btn:hover{opacity:.95}
      .nx-btn:active{transform:translateY(1px)}
      .nx-btn-cyan{ background:var(--nx-cyan); color:#0b101b; border-color:#0d3540; box-shadow:0 0 10px rgba(0,230,255,.3); }

      /* Inputs */
      .nx-input{
        width:100%; border-radius:12px; border:1px solid var(--nx-border);
        background:var(--nx-dark-2); color:var(--nx-text); padding:.55rem .7rem; outline:none;
      }
      .nx-input:focus{border-color:var(--nx-cyan); box-shadow:0 0 0 2px rgba(0,230,255,.14)}

      /* Scrollbar */
      ::-webkit-scrollbar{width:10px;height:10px}
      ::-webkit-scrollbar-track{background:var(--nx-dark-2);border:1px solid #1b2450;border-radius:6px;box-shadow:inset 0 0 8px rgba(0,230,255,.12)}
      ::-webkit-scrollbar-thumb{border-radius:6px;background:var(--nx-cyan);box-shadow:0 0 8px rgba(0,230,255,.35);border:2px solid var(--nx-dark-2)}
      ::-webkit-scrollbar-thumb:hover{background:#6ff3ff}
      *{scrollbar-width:thin; scrollbar-color: var(--nx-cyan) var(--nx-dark-2)}

      /* Popovers / Modals */
      .popover{position:absolute; z-index:1000; border:1px solid var(--nx-border); background:rgba(13,16,34,.98); box-shadow:0 10px 30px rgba(0,0,0,.4); border-radius:12px;}
      .modal-fx{ position:fixed; inset:0; display:grid; place-items:center; z-index:2100; background:rgba(0,0,0,.55); padding:12px; }
      .modal-fx.hidden{ display:none !important; }

      /* SEARCH dropdown (homepage/coin style) */
      #search-wrap:focus-within .nx-input{ border-color:var(--nx-cyan); box-shadow:0 0 0 2px rgba(0,230,255,.14); }
      .search-row{ display:flex; align-items:center; gap:.75rem; padding:.45rem .6rem; border-radius:10px; }
      .search-row:hover{ background: var(--nx-dark-2); }
      .search-icon{ height:2rem; width:2rem; display:flex; align-items:center; justify-content:center; border-radius:8px; background:var(--nx-dark-2); }
      .search-grid{ display:grid; grid-template-columns: 1fr auto auto auto; gap:.75rem; align-items:center; min-width:0; }
      .search-name{ min-width:0; }
      .search-name .ticker{ font-size:11px; color:#8b97c9; }
      .search-metric{ font-size:11px; color:#9fb3ff; white-space:nowrap; }
      .search-active{ outline:2px solid var(--nx-cyan); outline-offset:2px; }

      /* Table */
      .nx-table{ width:100%; border-collapse:separate; border-spacing:0; }
      .nx-th, .nx-td{ padding:10px 10px; text-align:left; border-bottom:0; }
      thead .nx-th{
        position:sticky; top:0; z-index:20; user-select:none;
        background:rgba(32,36,64,.95); color:#ffeb3b; text-shadow:0 0 3px #ffeb3b; border-bottom:1px solid var(--nx-border);
      }
      tbody tr{ position:relative; }
      tbody tr::after{
        content:""; position:absolute; left:0; right:0; bottom:0; height:1px; background:#333a66; pointer-events:none;
      }
      tbody tr:hover{ background:rgba(10,14,28,.6); box-shadow: inset 0 0 0 1px rgba(0,230,255,.08); }

      .pill{ display:inline-block; padding:2px 8px; border-radius:999px; font-size:11px; }
      .pill.green{ background:rgba(16,185,129,.18); color:#34d399; }
      .pill.red{ background:rgba(239,68,68,.18); color:#f87171; }
      .pill.cyan{ background:rgba(0,230,255,.15); border:1px solid rgba(0,230,255,.35); color:#9af6ff; }
      .pill.pink{ background:rgba(255,60,160,.12); border:1px solid rgba(255,60,160,.35); color:#ffb8e2; }

      /* Small row buttons (match NewPairs) */
      .mini-btn{ padding:.38rem .6rem; border:1px solid var(--nx-border); border-radius:12px; background:var(--nx-dark-2); color:#fff; font-weight:700; }
      .mini-btn.alert{ background:#FF1493; border-color:#7a1b5a; }
      .star-btn{ padding:.38rem .6rem; border:1px solid var(--nx-border); border-radius:12px; background:var(--nx-dark-2); color:#fff; font-weight:700; }
      .star-btn.active{ background:#ffd54a; color:#000; border-color:#a37c00; }

      /* Watchlist star */
      .star-btn{ width:28px; height:28px; border-radius:8px; border:1px solid var(--nx-border); background:rgba(25,30,55,.7); }
      .star-btn.active{ background:rgba(255,215,0,.12); border-color:#ffeb3b; color:#ffeb3b; text-shadow:0 0 8px rgba(255,235,59,.35); }

      /* Alerts modal */
      .popover{ background:rgba(16,20,40,.98); border:1px solid var(--nx-border); border-radius:12px; box-shadow:0 16px 50px rgba(0,0,0,.5), 0 0 0 1px rgba(0,230,255,.08); }
      .hidden{ display:none; }

      /* Row flash on add */
      @keyframes flashNew{ 0%{ background:rgba(0,230,255,.10);} 100%{ background:transparent;} }
      .flash-new{ animation:flashNew 2s ease 1; }

      /* Footer */
      footer .nx-link{ color:#a1b5ff; text-decoration:underline dotted; text-underline-offset:3px; }
    </style>
  </head>
  <body>
    <!-- Header -->
    <header class="sticky top-0 z-[1000] isolate border-b border-[var(--nx-border)] bg-[rgba(10,13,27,0.9)] backdrop-blur-sm">
      <div class="page-wrap h-7 px-1 flex items-center justify-between">
        <div class="flex items-center gap-3">
          <a href="NebulaX.html" class="flex items-center gap-2">
            <img src="NebulaX-logo.png" class="h-6 w-6 rounded-md" alt="NebulaX"/>
            <span class="font-bold tracking-wide" style="text-shadow:0 0 2px var(--nx-cyan);">NEBULAX</span>
          </a>
          <nav class="hidden sm:flex items-center gap-2 ml-2">
            <a class="nx-btn px-2 py-1 text-xs" href="NebulaX.html">Home</a>
            <a class="nx-btn px-2 py-1 text-xs" href="NewPairs-official.html">New Pairs</a>
            <a class="nx-btn px-2 py-1 text-xs" href="Trending.html">Trending</a>
            <a class="nx-btn px-2 py-1 text-xs" href="portfolio_official_v_2_fixed.html">Portfolio</a>
            <a class="nx-btn px-2 py-1 text-xs" href="Adrenaline-official.html">Adrenaline</a>
            <a class="nx-btn px-2 py-1 text-xs" href="nebula_x_store_official.html">Store</a>
            <a class="nx-btn px-2 py-1 text-xs" href="NEBX-Arcade.html">Arcade</a>
          </nav>
        </div>

        <!-- SEARCH -->
        <div id="search-wrap" class="relative w-[26rem] max-w-[60vw]">
          <input id="search-input" class="nx-input" placeholder="Search markets... /" autocomplete="off"/>
          <div id="search-dd" class="popover hidden mt-1 w-full max-h-[22rem] overflow-auto p-2"></div>
        </div>

        <!-- Wallet + Profile -->
        <div class="flex items-center gap-2">
          <button id="wallet-btn" class="nx-btn"><i data-lucide="wallet" class="w-3 h-3 mr-2"></i> Connect Wallet</button>
          <button id="nx-profile" class="relative w-8 h-8 rounded-xl overflow-hidden border"
                  style="border-color:var(--nx-border)">
            <img id="nx-pfp" src="NebulaX-logo.png" alt="" class="absolute inset-0 w-full h-full object-cover" />
          </button>
        </div>
      </div>


</header>

    <!-- Wallet Modal Popup -->
    <div id="wallet-modal" class="modal-fx hidden">
      <div class="nx-panel w-[380px] max-w-[90vw] p-4">
        <div class="flex items-center justify-between mb-3">
          <div class="text-lg font-semibold">Wallet</div>
          <button class="nx-btn nx-btn-cyan px-2 py-1 text-xs" onclick="document.getElementById('wallet-modal').classList.add('hidden')">Close</button>
        </div>
        <div class="grid grid-cols-2 gap-2 text-sm mb-3">
          <div class="nx-panel p-3">
            <div class="text-xs text-zinc-400 mb-1">Total Balance</div>
            <div class="font-semibold text-base" id="wallet-total">0.000 SOL</div>
          </div>
          <div class="nx-panel p-3">
            <div class="text-xs text-zinc-400 mb-1">Available</div>
            <div class="font-semibold text-base" id="wallet-available">0.000 SOL</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-2 mb-3">
          <button id="wd-open" class="nx-btn">Withdraw</button>
          <button id="dp-open" class="nx-btn nx-btn-cyan">Deposit</button>
        </div>
        <div class="grid grid-cols-2 gap-2">
          <button id="wallet-connect" class="nx-btn nx-btn-cyan">Connect</button>
          <button id="wallet-disconnect" class="nx-btn">Disconnect</button>
        </div>
      </div>
    </div>

    <!-- Deposit / Withdraw modals -->
    <div id="deposit" class="modal-fx hidden">
      <div class="nx-panel w-[360px] max-w-[90vw] p-3">
        <div class="flex items-center justify-between mb-2"><div class="font-semibold">Deposit</div><button class="nx-btn nx-btn-cyan px-2 py-1 text-xs" onclick="document.getElementById('deposit').classList.add('hidden')">Close</button></div>
        <div class="text-sm text-zinc-400 mb-2">Send SOL to your platform wallet address:</div>
        <div class="nx-panel p-2 text-xs break-words" id="deposit-addr">Do7AJiNrJvFVGTUCw8XvVhRGVBVLTHcBvEnfi3K68gze</div>
        <button class="nx-btn nx-btn-cyan w-full mt-3" id="copy-deposit-btn">Copy Address</button>
      </div>
    </div>
    <div id="withdraw" class="modal-fx hidden">
      <div class="nx-panel w-[360px] max-w-[90vw] p-3">
        <div class="flex items-center justify-between mb-2"><div class="font-semibold">Withdraw</div><button class="nx-btn nx-btn-cyan px-2 py-1 text-xs" onclick="document.getElementById('withdraw').classList.add('hidden')">Close</button></div>
        <div class="space-y-2">
          <input class="nx-input" placeholder="Destination SOL address"/>
          <div class="grid grid-cols-3 gap-2">
            <input class="nx-input col-span-2" placeholder="Amount"/>
            <select class="nx-input"><option>SOL</option><option>USD</option></select>
          </div>
          <button class="nx-btn nx-btn-cyan w-full">Submit</button>
        </div>
      </div>
    </div>

    <!-- Main -->
    <div class="page-wrap">
      <div class="grid grid-cols-1 lg:grid-cols-[1fr_360px] gap-3">
        <!-- LEFT PANEL -->
        <section class="nx-panel p-3">
          <div class="flex items-center justify-between mb-2">
            <div>
              <div class="text-xl nx-title">New Pairs</div>
              <div class="text-xs text-zinc-400">Freshly-detected token pairs (mock). Auto-refreshing list.</div>
            </div>
          </div>

          <!-- Filters -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-2 mb-2">
            <div>
              <label class="text-xs text-zinc-400 block mb-1">Min Liquidity ($)</label>
              <input class="nx-input tabnums" id="f-liq" type="number" min="0" placeholder="0" value="0"/>
            </div>

            <div>
              <label class="text-xs text-zinc-400 block mb-1">Max Age</label>
              <select id="f-age" class="nx-input">
                <option value="any">Any</option>
                <option value="10m">≤ 10 min</option>
                <option value="5m">≤ 5 min</option>
                <option value="2m">≤ 2 min</option>
                <option value="1m">≤ 1 min</option>
              </select>
            </div>

            <div>
              <label class="text-xs text-zinc-400 block mb-1">Verified?</label>
              <select id="f-verified" class="nx-input">
                <option value="any">Any</option>
                <option value="yes">Verified</option>
                <option value="no">Unverified</option>
              </select>
            </div>
          </div>

          <!-- Table -->
          <div class="nx-panel p-2">
            <div class="themed-scroll overflow-auto max-h-[60vh] rounded-lg">
              <table style="width:100%;">
              <thead>
                <tr>
                  <th class="nx-th">Pair</th>
                  <th class="nx-th text-right">Price/MC</th>
                  <th class="nx-th text-right">24h Change</th>
                  <th class="nx-th text-right">Volume</th>
                  <th class="nx-th text-right">Liquidity</th>
                  <th class="nx-th text-right">Age</th>
                  <th class="nx-th">Actions</th>
                </tr>
              </thead>
              <tbody id="pairs-body"></tbody>
            </table>
            </div>
          </div>
        </section>

        <!-- RIGHT PANEL (widgets) -->
        <aside class="nx-panel p-3">
          <!-- Watchlist -->
          <div class="nx-panel p-3 mb-3">
            <div class="flex items-center justify-between mb-2">
              <div class="text-sm font-semibold">Watchlist</div>
              <button id="watch-clear" class="nx-btn px-2 py-1 text-xs">Clear</button>
            </div>
            <div id="watchlist"><div class="text-zinc-400 text-xs">No pairs saved yet.</div></div>
          </div>

          <!-- Alerts Preview -->
          <div class="nx-panel p-3 mb-3">
            <div class="text-sm font-semibold mb-2">Alerts Preview</div>
            <div class="flex gap-2 mb-2">
              <button id="btn-clear-alerts" class="nx-btn">Clear All Alerts</button>
            </div>
            <div id="alerts-mini"><div class="text-zinc-400 text-xs">No triggers yet.</div></div>
          </div>

          <!-- Feed Status -->
          <div class="nx-panel p-3">
            <div class="text-sm font-semibold mb-2">Feed Status</div>
            <div class="text-xs text-zinc-400">Connected to mock feed.</div>
          </div>
        </aside>
      </div>
    </div>

    <!-- Footer -->
    <footer class="mt-3">
      <div class="page-wrap">
        <div class="nx-panel p-3 text-xs text-zinc-400">
          <div class="mb-1">
            <span class="nx-title">NOTE:</span> This New Pairs page is purely a front-end mock for layout, styling and interactions. API wiring (pairs feed, holders, alerts, watchlist persistence) can be swapped in later without changing UI.
          </div>
          <div>&copy; <span id="year"></span> NebulaX • New Pairs • Front-end mock</div>
        </div>
      </footer>
    </div>

    <!-- Alerts Modal (per-coin rules) -->
    <div id="alertsModal" class="popover hidden fixed right-4 top-16 w-80 p-3">
      <div class="flex items-center justify-between mb-2">
        <div class="text-sm font-semibold">ENABLE ALERTS</div>
        <button id="alert-cancel" class="nx-btn nx-btn-cyan px-2 py-1 text-xs">Close</button>
      </div>
      <div class="space-y-2 text-sm">
        <label class="flex items-center justify-between px-2 py-1 rounded-md hover:bg-[var(--nx-dark-2)]">
          <span>Whale buy</span><input type="checkbox" value="whale_buy">
        </label>
        <label class="flex items-center justify-between px-2 py-1 rounded-md hover:bg-[var(--nx-dark-2)]">
          <span>Price change</span><input type="checkbox" value="price_change">
        </label>
        <label class="flex items-center justify-between px-2 py-1 rounded-md hover:bg-[var(--nx-dark-2)]">
          <span>Volume spike</span><input type="checkbox" value="volume_spike">
        </label>
        <label class="flex items-center justify-between px-2 py-1 rounded-md hover:bg-[var(--nx-dark-2)]">
          <span>Buys &gt; Sells</span><input type="checkbox" value="buys_sells_ratio">
        </label>
        <label class="flex items-center justify-between px-2 py-1 rounded-md hover:bg-[var(--nx-dark-2)]">
          <span>Holders change</span><input type="checkbox" value="holders_delta">
        </label>
      </div>
      <div class="flex justify-end gap-2 mt-2">
        <button id="alert-save" class="nx-btn nx-btn-cyan px-2 py-1 text-xs">Save</button>
      </div>
    </div>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
      /* Icons + Year */
      if (window.lucide && typeof window.lucide.createIcons==='function'){ window.lucide.createIcons(); }
      document.getElementById('year').textContent = new Date().getFullYear();

      /* Back */
      document.getElementById('back-btn')?.addEventListener('click', (e)=>{ e.preventDefault(); history.back(); });

      /* ===== SEARCH (same style/behavior as current pages) ===== */
      (function(){
        const input = document.getElementById('search');
        const dd = document.getElementById('search-dd');
        const results = document.getElementById('search-results');
        if (!input || !dd || !results) return; // Elements don't exist on this page
        
        function show(){ dd.classList.remove('hidden'); }
        function hide(){ dd.classList.add('hidden'); }
        function render(items){
          results.innerHTML = items.map(it=>{
            const p = it;
            const pair = `${(p.baseToken?.symbol||'BASE').toUpperCase()}/${(p.quoteToken?.symbol||'QUOTE').toUpperCase()}`;
            const addr = p.pairAddress||'';
            const mint = p.baseToken?.address||'';
            return `<div class="flex items-center justify-between nx-btn p-2 cursor-pointer" data-pair="${pair}" data-addr="${addr}" data-mint="${mint}">
              <div class="text-sm"><strong>${pair}</strong></div>
              <div class="text-xs text-zinc-400">${addr ? addr.slice(0,4)+'…'+addr.slice(-4) : ''}</div>
            </div>`;
          }).join('') || `<div class="text-xs text-zinc-400 p-2">No results.</div>`;
        }
        input.addEventListener('focus', show);
        input.addEventListener('blur', ()=> setTimeout(hide, 150));
        input.addEventListener('input', async ()=>{
          const q = input.value.trim();
          if(!q){ results.innerHTML=''; return; }
          try{
            const url = `https://api.dexscreener.com/latest/dex/search?q=${encodeURIComponent(q+' solana')}`;
            const r = await fetch(url); const j = await r.json();
            render(j.pairs||[]);
          }catch(e){ console.error(e); }
        });
        results.addEventListener('click', (e)=>{
          const el = e.target.closest('[data-pair]'); if(!el) return;
          const pair = el.getAttribute('data-pair')||'';
          const addr = el.getAttribute('data-addr')||'';
          const mint = el.getAttribute('data-mint')||'';
          NX.goToCoin({ pair, mint, pairAddress: addr });
        });
      })();

      /* ===== New Pairs engine (same logic, themed UI) ===== */
      const pairsBody = document.getElementById('pairs-body');
      const fLiq = document.getElementById('f-liq');
      const fAge = document.getElementById('f-age');
      const fVer = document.getElementById('f-verified');

      function rnd(a,b){ return Math.random()*(b-a)+a; }
      function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
      const NAMES=['WIF','BONK','MEW','POPCAT','GME','BOME','PENGU','DOG','CAT','MOON','STAR','NEB','ZAP','FLOOF','FOOM'];

      // State: per-coin alerts & watchlist
      const alertsForPair = {}; // { 'BONK/SOL': Set([...]) }
      const watchlistSet = new Set();

      // Sorting state
      let sortKey = 'age'; // default
      let sortDir = 'asc'; // 'asc' | 'desc'
      const sorters = {
        pair: (a,b)=> a.pair.localeCompare(b.pair),
        age:  (a,b)=> a.ageMin - b.ageMin,
        mc:   (a,b)=> a.mc - b.mc,
        liq:  (a,b)=> a.liq - b.liq,
        vol:  (a,b)=> a.vol - b.vol,
        holders:(a,b)=> a.holders - b.holders
      };

      // Newly-added flash tracker
      const newFlashSet = new Set(); // pair strings
      function markFlash(pair){
        newFlashSet.add(pair);
        setTimeout(()=> newFlashSet.delete(pair), 2000);
      }

      

      function fmtUSD(n){
        if(n>=1_000_000_000) return '$'+(n/1_000_000_000).toFixed(2)+'B';
        if(n>=1_000_000) return '$'+(n/1_000_000).toFixed(2)+'M';
        if(n>=1_000) return '$'+(n/1_000).toFixed(2)+'K';
        return '$'+n.toString();
      }

      function rowHTML(r){
        const age = prettyAge(r.ageMin);
        const chgPill = r.chg>=0 ? `<span class="pill green">+${r.chg}%</span>` : `<span class="pill red">${r.chg}%</span>`;
        const ver = r.verified ? `<span class="pill cyan">Verified</span>` : `<span class="pill pink">Unverified</span>`;
        const starred = watchlistSet.has(r.pair) ? 'active' : '';
        const flashCls = newFlashSet.has(r.pair) ? 'flash-new' : '';
        return `
          <tr class="${flashCls}" data-id="${r.id}">
            <td class="nx-td"><strong>${r.pair}</strong> ${chgPill} ${ver}</td>
            <td class="nx-td">${age}</td>
            <td class="nx-td">${fmtUSD(r.mc)}</td>
            <td class="nx-td">${fmtUSD(r.liq)}</td>
            <td class="nx-td">${fmtUSD(r.vol)}</td>
            <td class="nx-td tabnums">${r.holders.toLocaleString()}</td>
            <td class="nx-td" style="display:flex; gap:6px;">
              <button class="mini-btn alert" data-act="alert">Alert</button>
              <button class="star-btn ${starred}" data-act="star">★</button>
            </td>
          </tr>
        `;
      }

      function passFilters(r){
        const minL = Math.max(0, parseFloat(fLiq.value||'0'));
        if(r.liq < minL) return false;

        const ageSel = fAge.value;
        if(ageSel==='10m' && r.ageMin>10) return false;
        if(ageSel==='5m'  && r.ageMin>5)  return false;
        if(ageSel==='2m'  && r.ageMin>2)  return false;
        if(ageSel==='1m'  && r.ageMin>1)  return false;

        const vSel = fVer.value;
        if(vSel==='yes' && !r.verified) return false;
        if(vSel==='no'  &&  r.verified) return false;

        return true;
      }

      function applySort(arr){
        const cmp = sorters[sortKey] || sorters.age;
        const sorted = arr.slice().sort(cmp);
        return sortDir==='asc' ? sorted : sorted.reverse();
      }

      function updateSortHeaders(){
        document.querySelectorAll('th.sortable').forEach(th=>{
          th.classList.remove('asc','desc');
          if(th.dataset.sort === sortKey){
            th.classList.add(sortDir);
          }
        });
      }

      function prettyAge(mins){
        if(mins<1) return '&lt;1m';
        if(mins<60) return `${mins}m`;
        const h=Math.floor(mins/60), m=mins%60;
        return `${h}h ${m}m`;
      }

      function render(){
        const filtered = ROWS.filter(passFilters);
        const sorted = applySort(filtered);
        const limited = sorted.slice(0,50);
        const html = limited.map(rowHTML).join('');
        pairsBody.innerHTML = html || `<tr><td class="nx-td" colspan="7"><div class="text-center text-zinc-400 py-3">No results.</div></td></tr>`;
        updateSortHeaders();
      }

      [fLiq,fAge,fVer].forEach(el=> el.addEventListener('input', render));

      // Sorting events
      document.querySelectorAll('th.sortable').forEach(th=>{
        th.addEventListener('click', ()=>{
          const key = th.dataset.sort;
          if(key===sortKey){
            sortDir = sortDir==='asc' ? 'desc' : 'asc';
          }else{
            sortKey = key;
            sortDir = 'asc';
          }
          render();
        });
      });

pairsBody.addEventListener('click', (e)=>{
  const tr = e.target.closest('tr[data-id]'); if(!tr) return;

  // buttons inside the row should NOT route
  const btn = e.target.closest('button');
  if(btn){
    const act = btn.getAttribute('data-act');
    if(act === 'alert'){ openAlertModal(tr.querySelector('td strong')?.textContent.trim()); }
    if(act === 'star'){ toggleWatch(tr.querySelector('td strong')?.textContent.trim(), btn); }
    return;
  }

  const id = tr.getAttribute('data-id');
  const row = ROWS.find(r => String(r.id) === String(id));
  if(!row) return;

  NX.goToCoin({ pair: row.pair, mint: row.mint || '', pairAddress: row.pairAddress || '' });
});


      // Watchlist
      function toggleWatch(pair, btn){
        if(watchlistSet.has(pair)){ watchlistSet.delete(pair); } else { watchlistSet.add(pair); }
        btn.classList.toggle('active', watchlistSet.has(pair));
        redrawWatchlist();
      }
      function redrawWatchlist(){
        const box = document.getElementById('watchlist');
        const arr = Array.from(watchlistSet);
        if(!arr.length){ box.innerHTML='<div class="text-zinc-400 text-xs">No pairs saved yet.</div>'; return; }
        box.innerHTML = arr.map(p=>`<div class="flex items-center justify-between text-sm py-1 border-b border-[var(--nx-border)]">
          <span>${p}</span>
          <div class="flex gap-1">
            <button class="nx-btn h-6 px-2 text-xs" onclick="goToPair('${p.replace(/'/g,"\\'")}')">Open</button>
            <button class="nx-btn h-6 px-2 text-xs" onclick="toggleWatch('${p.replace(/'/g,"\\'")}', this)">Remove</button>
          </div>
        </div>`).join('');
      }
      document.getElementById('watch-clear').addEventListener('click', ()=>{ watchlistSet.clear(); redrawWatchlist(); });

      // Alerts modal logic (lightweight mock)
      const modal = document.getElementById('alertsModal');
      const alertsBtn = document.getElementById('alerts-btn');
      const alertCancel = document.getElementById('alert-cancel');
      const alertSave = document.getElementById('alert-save');
      
      if (alertsBtn) alertsBtn.addEventListener('click', ()=> modal?.classList.remove('hidden'));
      if (alertCancel) alertCancel.addEventListener('click', ()=> modal?.classList.add('hidden'));
      if (alertSave) alertSave.addEventListener('click', ()=>{
        modal.classList.add('hidden');
        const rules = Array.from(modal.querySelectorAll('input[type=checkbox]:checked')).map(cb=>cb.value);
        const pair = ROWS[0]?.pair || 'WIF/SOL';
        alertsForPair[pair] = new Set(rules);
        pushAlertPreview(pair, rules);
      });
      function openAlertModal(pair){ modal.classList.remove('hidden'); }
      function pushAlertPreview(pair, rules){
        const mini = document.getElementById('alerts-mini');
        const row = document.createElement('div');
        row.className='text-sm py-1 border-b border-[var(--nx-border)] cursor-pointer hover:bg-[rgba(0,230,255,.08)]';
        row.setAttribute('data-pair', pair);
        row.textContent = `${pair}: ${rules.length?rules.join(', '):'No rules selected'} (saved mock)`;
        mini.prepend(row);
        while(mini.children.length>12) mini.removeChild(mini.lastChild);
      }
      document.getElementById('alerts-mini').addEventListener('click', (e)=>{
        const el = e.target.closest('[data-pair]');
        if (!el) return;
        goToPair(el.getAttribute('data-pair'));
      });
      document.getElementById('btn-clear-alerts').addEventListener('click', ()=>{
        for (const k in alertsForPair) delete alertsForPair[k];
        const mini = document.getElementById('alerts-mini');
        mini.innerHTML = '<div class="text-zinc-400 text-xs">No triggers yet.</div>';
      });

      // Central nav helper (replace with router later)
      function goToPair(pair){
        const row = ROWS.find(r=> r.pair===pair);
        if(row){ NX.goToCoin({ pair: row.pair, mint: row.mint || '', pairAddress: row.pairAddress||'' }); }
      }
    </script>


<script>
/** ===== NebulaX Click-to-Coin Utilities ===== */
window.NX = window.NX || {};
NX.saveSelectedCoin = function(coin){
  try { localStorage.setItem('nebula_selected_coin', JSON.stringify(coin)); } catch(e){}
};
NX.goToCoin = function(coin){
  NX.saveSelectedCoin(coin);
  const pair = coin.pair || (coin.symbol ? (coin.symbol.toUpperCase()+'/SOL') : '');
  const mint = encodeURIComponent(coin.mint || '');
  const pairAddr = coin.pairAddress || coin.pairAddr || '';
  const qp = `?pair=${encodeURIComponent(pair)}${mint ? `&mint=${mint}` : ''}${pairAddr ? `&pairAddr=${encodeURIComponent(pairAddr)}` : ''}`;
  location.href = `Coinpage-Official.html${pair ? qp : ''}`;
};
</script>

<script>
function nxOpenCoin({ pair, mint = '', pairAddr = '' }) {
  const url = `Coinpage-Official.html?pair=${encodeURIComponent(pair)}&mint=${encodeURIComponent(mint)}${pairAddr?`&pairAddr=${encodeURIComponent(pairAddr)}`:''}`;
  location.href = url;
}
</script>
<script>
/** ===== PUMP.FUN NEW TOKENS INTEGRATION ===== */
document.addEventListener('DOMContentLoaded', initPumpFunFeed);

// Configuration
const BIRDEYE_KEY = '267367afba5b44f2b7398e53aba49f5f';
const HEADERS = { 'X-API-KEY': BIRDEYE_KEY, 'x-chain': 'solana', 'accept': 'application/json' };
const REFRESH_INTERVAL = 5000; // 5 seconds (12 req/min = well under 30 limit)
const MAX_PAIRS_STORED = 200; // Keep last 200 pairs in memory

// In-memory store for seen pairs
let recentPairs = [];
let seenPoolIds = new Set();
let lastSeenCreatedAt = null;
let requestCount = 0;
let lastMinuteReset = Date.now();

// Rate limiting: max 30 requests per minute
function canMakeRequest() {
  const now = Date.now();
  if (now - lastMinuteReset >= 60000) {
    requestCount = 0;
    lastMinuteReset = now;
  }
  if (requestCount >= 30) {
    // Don't spam console warnings
    return false;
  }
  return true;
}

// Fetch new pools from GeckoTerminal
async function fetchGeckoTerminalNewPools() {
  if (!canMakeRequest()) {
    // Silently skip when rate limited
    return [];
  }
  
  try {
    requestCount++;
    const response = await fetch('https://api.geckoterminal.com/api/v2/networks/solana/new_pools?include=base_token,quote_token,dex&page=1');
    
    if (!response.ok) {
      if (response.status === 429) {
        console.warn('Rate limited by GeckoTerminal, backing off...');
        await new Promise(r => setTimeout(r, 30000)); // Wait 30s
      }
      return [];
    }
    
    const data = await response.json();
    const pools = data.data || [];
    const included = data.included || [];
    
    // Build lookup map for included entities
    const includedMap = new Map();
    included.forEach(item => {
      includedMap.set(`${item.type}:${item.id}`, item);
    });
    
    // Process pools
    const newPools = [];
    
    for (const pool of pools) {
      const poolId = pool.id;
      const attr = pool.attributes || {};
      const rel = pool.relationships || {};
      
      // Skip if already seen
      if (seenPoolIds.has(poolId)) continue;
      
      // Check if newer than last seen
      const createdAt = attr.pool_created_at;
      if (lastSeenCreatedAt && createdAt <= lastSeenCreatedAt) continue;
      
      // Get related entities
      const baseTokenData = rel.base_token?.data;
      const quoteTokenData = rel.quote_token?.data;
      const dexData = rel.dex?.data;
      
      const baseToken = baseTokenData ? includedMap.get(`${baseTokenData.type}:${baseTokenData.id}`) : null;
      const quoteToken = quoteTokenData ? includedMap.get(`${quoteTokenData.type}:${quoteTokenData.id}`) : null;
      const dex = dexData ? includedMap.get(`${dexData.type}:${dexData.id}`) : null;
      
      const baseAttr = baseToken?.attributes || {};
      const quoteAttr = quoteToken?.attributes || {};
      const dexAttr = dex?.attributes || {};
      
      const newPair = {
        poolId,
        poolAddress: attr.address || '',
        dexName: dexAttr.name || 'Unknown',
        baseTokenMint: baseAttr.address || '',
        baseTokenSymbol: baseAttr.symbol || 'UNKNOWN',
        baseTokenName: baseAttr.name || '',
        quoteTokenMint: quoteAttr.address || '',
        quoteTokenSymbol: quoteAttr.symbol || 'QUOTE',
        quoteTokenName: quoteAttr.name || '',
        poolCreatedAt: createdAt,
        liquidityUsd: parseFloat(attr.reserve_in_usd) || 0,
        // Additional useful data
        price: parseFloat(attr.base_token_price_usd) || 0,
        mcapUsd: parseFloat(attr.fdv_usd) || 0,
        vol24h: parseFloat(attr.volume_usd?.h24) || 0,
        pct24h: parseFloat(attr.price_change_percentage?.h24) || 0,
        logoURI: baseAttr.image_url || null,
        mint: baseAttr.address || ''
      };
      
      newPools.push(newPair);
      seenPoolIds.add(poolId);
      
      // Log new discovery
      console.log(`[NEW PAIR] ${dexAttr.name} | ${baseAttr.symbol}/${quoteAttr.symbol} | $${newPair.liquidityUsd.toFixed(0)} liq | ${createdAt}`);
    }
    
    // Update last seen timestamp
    if (pools.length > 0) {
      const latestCreatedAt = pools[0]?.attributes?.pool_created_at;
      if (latestCreatedAt && (!lastSeenCreatedAt || latestCreatedAt > lastSeenCreatedAt)) {
        lastSeenCreatedAt = latestCreatedAt;
      }
    }
    
    return newPools;
  } catch (e) {
    console.error('GeckoTerminal fetch error:', e);
    return [];
  }
}

// Fetch new tokens - calls GeckoTerminal and updates in-memory store
async function fetchPumpFunNewTokens() {
  const newPools = await fetchGeckoTerminalNewPools();
  
  // Add to recent pairs (prepend newest)
  if (newPools.length > 0) {
    recentPairs = [...newPools, ...recentPairs].slice(0, MAX_PAIRS_STORED);
  }
  
  // Return current pairs for display
  return recentPairs.map(p => ({
    mint: p.mint || p.baseTokenMint,
    symbol: p.baseTokenSymbol,
    name: p.baseTokenName,
    logoURI: p.logoURI,
    pairAddress: p.poolAddress,
    ageMin: Math.floor((Date.now() - new Date(p.poolCreatedAt).getTime()) / 60000),
    price: p.price,
    mcapUsd: p.mcapUsd,
    liqUsd: p.liquidityUsd,
    vol24h: p.vol24h,
    pct24h: p.pct24h,
    pct1h: 0,
    txns24h: 0,
    dex: p.dexName,
    verified: false
  }));
}

// Enhance tokens with Birdeye data (skip for GeckoTerminal - already has good data)
async function enhanceWithBirdeye(tokens) {
  // GeckoTerminal already provides comprehensive data, skip Birdeye
  return tokens;
}

// Format numbers
function compact(x) {
  if (!x && x !== 0) return '—';
  const num = Number(x);
  if (num >= 1e9) return `${(num/1e9).toFixed(2)}B`;
  if (num >= 1e6) return `${(num/1e6).toFixed(2)}M`;
  if (num >= 1e3) return `${(num/1e3).toFixed(2)}K`;
  return num.toFixed(2);
}

function formatAge(min) {
  if (!min && min !== 0) return '—';
  if (min < 1) return '<1m';
  if (min < 60) return `${min}m`;
  if (min < 1440) return `${Math.floor(min/60)}h`;
  return `${Math.floor(min/1440)}d`;
}

// Render table row
function renderRow(token) {
  const pair = `${token.symbol}/SOL`;
  const changeClass = token.pct24h > 0 ? 'text-green-400' : token.pct24h < 0 ? 'text-red-400' : '';
  const change = token.pct24h ? `${token.pct24h > 0 ? '+' : ''}${token.pct24h.toFixed(2)}%` : '—';
  
  return `
    <tr class="cursor-pointer hover:bg-[var(--nx-dark-2)] transition-colors" 
        onclick="nxOpenCoin({ pair: '${pair}', mint: '${token.mint}', pairAddr: '${token.pairAddress}' })">
      <td class="py-2 px-3">
        <div class="flex items-center gap-2">
          ${token.logoURI ? 
            `<img src="${token.logoURI}" class="w-8 h-8 rounded-md" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" alt="${token.symbol}"/><div class="w-8 h-8 rounded-md bg-zinc-800 flex-shrink-0 items-center justify-center text-xs text-zinc-500" style="display:none;">${token.symbol.substring(0,2)}</div>` 
            : 
            `<div class="w-8 h-8 rounded-md bg-zinc-800 flex items-center justify-center text-xs text-zinc-500">${token.symbol.substring(0,2)}</div>`
          }
          <div class="w-2 h-2 rounded-full ${token.verified ? 'bg-cyan-400' : 'bg-zinc-500'}"></div>
          <span class="font-semibold">${pair}</span>
        </div>
      </td>
      <td class="py-2 px-3 text-right">
        <div class="font-bold text-base">${compact(token.mcapUsd)}</div>
        <div class="text-xs text-zinc-400">$${token.price ? token.price.toFixed(6) : '0.000000'}</div>
      </td>
      <td class="py-2 px-3 text-right ${changeClass}">${change}</td>
      <td class="py-2 px-3 text-right">${compact(token.vol24h)}</td>
      <td class="py-2 px-3 text-right">${compact(token.liqUsd)}</td>
      <td class="py-2 px-3 text-right">${formatAge(token.ageMin)}</td>
      <td class="py-2 px-3">
        <button class="nx-btn nx-btn-cyan px-3 py-1 text-xs" onclick="event.stopPropagation(); nxOpenCoin({ pair: '${pair}', mint: '${token.mint}', pairAddr: '${token.pairAddress}' })">
          Buy
        </button>
      </td>
    </tr>
  `;
}

// Main render function
let currentTokens = [];

async function renderNewTokens() {
  const tbody = document.getElementById('pairs-body');
  if (!tbody) return;
  
  try {
    // Fetch new tokens
    let tokens = await fetchPumpFunNewTokens();
    
    // Enhance with Birdeye
    tokens = await enhanceWithBirdeye(tokens);
    
    // Filter out tokens without essential data
    tokens = tokens.filter(t => t.symbol && t.symbol !== 'UNKNOWN' && (t.mcapUsd || t.price));
    
    currentTokens = tokens;
    
    // Render
    if (tokens.length === 0) {
      tbody.innerHTML = '<tr><td colspan="7" class="py-8 text-center text-zinc-400">No new tokens found. Refresh in a moment...</td></tr>';
    } else {
      tbody.innerHTML = tokens.map(renderRow).join('');
    }
    
    // Update status
    const status = document.querySelector('.text-zinc-400.text-xs');
    if (status) {
      status.textContent = `Showing ${tokens.length} new Pump.fun tokens · Updated ${new Date().toLocaleTimeString()}`;
    }
  } catch (e) {
    console.error('Render failed:', e);
    tbody.innerHTML = '<tr><td colspan="7" class="py-8 text-center text-red-400">Failed to load tokens. Retrying...</td></tr>';
  }
}

// Initialize
async function initPumpFunFeed() {
  // Initial render
  await renderNewTokens();
  
  // Auto-refresh every 10 seconds
  setInterval(renderNewTokens, REFRESH_INTERVAL);
}

// Start the feed when page loads
// Start the feed when page loads
window.addEventListener('DOMContentLoaded', initPumpFunFeed);
</script>

<script>
/* === NebulaX Core (themes, header hydrate, routing hooks) === */
(function(){
  const UserStore={
    key:'nx_user',
    state:{ wallet:null, theme:'default', pfp:{type:'builtin',url:'/pfp/default.png'} },
    load(){ try{ Object.assign(this.state, JSON.parse(localStorage.getItem(this.key)||'{}')); }catch{} },
    save(){ localStorage.setItem(this.key, JSON.stringify(this.state)); }
  };
  UserStore.load();

  const Theme={
    init(){
      const t = UserStore.state.theme || 'default';
      document.documentElement.setAttribute('data-theme', t);
      const sel = document.getElementById('nx-theme');
      if (sel) sel.value = t;
      sel?.addEventListener('change', (e)=>{
        const v=e.target.value;
        document.documentElement.setAttribute('data-theme', v);
        UserStore.state.theme=v; UserStore.save();
      });
    }
  };

  const Header={
    initActiveTab(){
      const here = location.pathname.replace(/\/+$/,'') || '/NebulaX.html';
      document.querySelectorAll('.nx-tab').forEach(a=>{
        const route = a.getAttribute('data-route');
        if (!route) return;
        if (route===here) a.classList.add('active');
        else a.classList.remove('active');
        a.addEventListener('click',(e)=>{
          // allow normal navigation
        });
      });
    },
    initSearch(){
      const input = document.getElementById('nx-search');
      const btn   = document.getElementById('nx-search-btn');
      if(!input||!btn) return;
      const go = ()=>{
        const q = (input.value||'').trim();
        if(!q) return;
        // Route to coin page convention: /Coinpage-Official.html?query=...
        location.href = `/Coinpage-Official.html?query=${encodeURIComponent(q)}`;
      };
      btn.addEventListener('click', go);
      input.addEventListener('keydown', (e)=>{ if(e.key==='Enter') go(); });
    },
    initPfp(){
      const img = document.getElementById('nx-pfp');
      if(img) img.src = (UserStore.state.pfp?.url)||'/pfp/default.png';
      const btn = document.getElementById('nx-profile');
      btn?.addEventListener('click',()=>{
        // simple MVP: cycle built-ins; later open profile modal
        const choices=['/pfp/default.png','/pfp/nx01.png','/pfp/nx02.png'];
        const idx = Math.max(0, choices.indexOf(UserStore.state.pfp?.url));
        const next = choices[(idx+1)%choices.length];
        UserStore.state.pfp={type:'builtin',url:next}; UserStore.save();
        if(img) img.src=next;
      });
    },
    initStore(){
      const a = document.getElementById('nx-store');
      if(!a) return;
      // keep as a link; if you make a modal later, hydrate here
    },
    initWallet(){
      const w = document.getElementById('nx-wallet');
      w?.addEventListener('click', ()=>{
        // hook your wallet adapter here
        alert('Connect wallet (hook your adapter)');
      });
    },
    mount(){ this.initActiveTab(); this.initSearch(); this.initPfp(); this.initStore(); this.initWallet(); }
  };

  document.addEventListener('DOMContentLoaded', ()=>{
    Theme.init();
    Header.mount();
  });
})();
</script>



  </body>
</html>

