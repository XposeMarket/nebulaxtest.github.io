<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>NebulaX • Connect Wallet</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="nx-theme.js"></script>
    <style>
      :root{ --nx-cyan:#00e6ff; --nx-dark:#0a0d1b; --nx-dark-2:#12152a; --nx-border:#1e2747; --nx-text:#e0e7ff; }
      html,body{height:100%;background:var(--nx-dark);color:var(--nx-text);font-family:'Orbitron','ui-monospace','SFMono-Regular',monospace}
      .nx-panel{ background:rgba(16,20,40,.92); border:1px solid var(--nx-border); box-shadow: inset 0 0 10px rgba(0,230,255,.18), 0 0 12px rgba(0,230,255,.08); backdrop-filter: blur(8px); border-radius: 16px; }
      .nx-btn{ border-radius:14px; padding:.65rem .95rem; font-weight:800; transition:transform .05s ease, opacity .18s ease, box-shadow .18s ease; border:1px solid var(--nx-border); background:var(--nx-dark-2); color:var(--nx-text);} 
      .nx-btn:hover{opacity:.95}
      .nx-btn:active{transform:translateY(1px)}
      .nx-btn-cyan{ background:var(--nx-cyan); color:#041018; border-color:#0d3540; box-shadow:0 0 10px rgba(0,230,255,.3); }

      /* ===== Subtle starfield (slow, sparse) ===== */
      .starfield{ position:fixed; inset:0; z-index:-1; overflow:hidden; }
      .stars, .stars2{ position:absolute; inset:-10% -10%; background:transparent; }
      .stars::before, .stars2::before{
        content:""; position:absolute; top:0; left:0; width:2px; height:2px; background:transparent;
        /* Few stars */
        box-shadow:
          12vw 8vh #cfe8ff, 22vw 18vh #b7d4ff, 34vw 10vh #e0f3ff, 48vw 22vh #c8e7ff, 60vw 6vh #e6faff,
          72vw 16vh #d7efff, 84vw 12vh #c2e3ff, 18vw 26vh #dff6ff, 5vw 18vh #b9d7ff, 28vw 30vh #cde6ff,
          40vw 26vh #e1f4ff, 52vw 32vh #c9e8ff, 66vw 28vh #d4eeff, 78vw 34vh #c6e5ff, 90vw 22vh #e8fbff,
          8vw 40vh #cfe8ff, 24vw 44vh #e0f3ff, 56vw 46vh #c2e3ff, 70vw 40vh #dff6ff, 86vw 44vh #cde6ff,
          12vw 56vh #e1f4ff, 30vw 60vh #c9e8ff, 48vw 58vh #d4eeff, 62vw 64vh #c6e5ff, 80vw 60vh #e8fbff,
          16vw 72vh #cfe8ff, 36vw 76vh #b7d4ff, 50vw 70vh #e0f3ff, 68vw 76vh #c8e7ff, 88vw 72vh #e6faff,
          22vw 86vh #d7efff, 42vw 90vh #c2e3ff, 64vw 88vh #dff6ff, 76vw 92vh #b9d7ff, 8vw 88vh #cde6ff;
        opacity:.9;
      }
      .stars2::before{ width:3px;height:3px;opacity:.7; box-shadow:
        15vw 14vh #e8fbff, 38vw 20vh #d4eeff, 58vw 18vh #c2e3ff, 74vw 24vh #c9e8ff, 92vw 16vh #e1f4ff,
        26vw 52vh #c6e5ff, 44vw 48vh #e8fbff, 68vw 54vh #cfe8ff, 82vw 50vh #b7d4ff,
        34vw 82vh #e0f3ff, 56vw 78vh #c8e7ff, 72vw 84vh #e6faff, 10vw 74vh #d7efff, 20vw 68vh #c2e3ff,
        90vw 90vh #dff6ff, 54vw 92vh #b9d7ff, 6vw 62vh #cde6ff, 12vw 24vh #e1f4ff; }
      @keyframes driftSlow { from{ transform:translateY(-1.5%)} to{ transform:translateY(1.5%)} }
      .stars{ animation: driftSlow 38s ease-in-out infinite alternate; }
      .stars2{ animation: driftSlow 52s ease-in-out infinite alternate; }
      @media (prefers-reduced-motion: reduce){ .stars,.stars2{ animation:none } }
    </style>
<style>
  /* Starfield sits behind all content, no clicks */
  #nx-stars{
    position: fixed;
    inset: 0;
    z-index: 0;            /* content sits above this naturally */
    pointer-events: none;  /* never intercept clicks */
  }
  /* Ensure your main containers render above the canvas */
  header, #root, .page-wrap, main { position: relative; z-index: 1; }
  @media (prefers-reduced-motion: reduce){
    #nx-stars{ display:none !important; }
  }
</style>

  </head>
  <body>
    <!-- Subtle star background -->
    <div class="starfield"><div class="stars"></div><div class="stars2"></div></div>
<!-- Subtle starfield background -->
<canvas id="nx-stars" aria-hidden="true"></canvas>

    <main class="min-h-full grid place-items-center p-4">
      <section class="nx-panel w-full max-w-[460px] p-5">
        <header class="flex items-center gap-3">
          <img src="NebulaX-logo.png" class="h-8 w-8 rounded-md" alt="NebulaX"/>
          <div>
            <h1 class="text-lg font-bold tracking-wide" style="text-shadow:0 0 2px var(--nx-cyan);">NEBULAX</h1>
            <p class="text-xs text-zinc-400">Connect your wallet to continue</p>
          </div>
        </header>

        <!-- Wallet connect only (no username/password) -->
        <div class="mt-5 grid gap-3">
          <label class="flex items-center gap-2 text-xs text-zinc-400">
            <input id="remember" type="checkbox" class="accent-cyan-500" checked>
            Remember this wallet on this device
          </label>
<button id="connect-btn"
  class="px-6 py-3 bg-[var(--nx-cyan)] text-black rounded-xl font-bold shadow-lg hover:opacity-90">
  Connect Phantom
</button>

          <button id="phantom-disconnect" class="nx-btn hidden">Disconnect</button>
          <div id="wallet-status" class="text-xs text-zinc-400">Not connected</div>
        </div>

        <div class="mt-5 h-px bg-[var(--nx-border)]"></div>
        <p class="text-[11px] text-zinc-500 mt-3">We identify your account by your wallet address. No passwords are stored.</p>
        <footer class="mt-4 text-[11px] text-zinc-500 text-center">&copy; <span id="yr"></span> NebulaX</footer>
      </section>
    </main>

    <script>
      // Simple wallet-only gate with localStorage. No auto-connect.
      const LKEY = 'nebula:wallet';
      const $ = (id)=>document.getElementById(id);
      const remember = $('remember');
      const connectBtn = $('connect-btn');
      const disconnectBtn = $('phantom-disconnect');
      const statusEl = $('wallet-status');
      $('yr').textContent = new Date().getFullYear();

      const short = (s)=> s ? (s.slice(0,4)+"…"+s.slice(-4)) : '';
      const save = (pk)=>{ try{ localStorage.setItem(LKEY, JSON.stringify({ pk })); }catch{} };
      const load = ()=>{ try{ return JSON.parse(localStorage.getItem(LKEY)||'{}').pk||null; }catch{return null} };
      const clear = ()=>{ try{ localStorage.removeItem(LKEY); }catch{} };

      function setConnected(pubkey){
        connectBtn.classList.add('hidden');
        disconnectBtn.classList.remove('hidden');
        statusEl.textContent = `Connected: ${short(pubkey)}`;
        statusEl.classList.remove('text-zinc-400');
        statusEl.classList.add('text-emerald-400');
      }
      function setDisconnected(msg){
        disconnectBtn.classList.add('hidden');
        connectBtn.classList.remove('hidden');
        statusEl.textContent = msg || 'Not connected';
        statusEl.classList.remove('text-emerald-400');
        statusEl.classList.add('text-zinc-400');
      }

      // Manual connect only
      connectBtn.addEventListener('click', async ()=>{
        const provider = window.solana;
        if (!provider || !provider.isPhantom){
          setDisconnected('Phantom not found — install it first');
          window.open('https://phantom.app/', '_blank');
          return;
        }
        try{
          const resp = await provider.connect({ onlyIfTrusted:false });
          const pk = resp?.publicKey?.toString?.() || provider?.publicKey?.toString?.() || '';
          if(remember.checked) save(pk);
          setConnected(pk);

          // Bounce to next page if present
          const next = new URLSearchParams(location.search).get('next');
          if(next) location.href = next;
        }catch(err){ setDisconnected('Connection cancelled'); }
      });

      disconnectBtn.addEventListener('click', async ()=>{
        try{ await window.solana?.disconnect?.(); }catch{}
        clear(); setDisconnected('Disconnected');
      });

      // If previously remembered, reflect that state (without auto-connecting)
      const remembered = load();
      if(remembered){ setConnected(remembered); }
      else if(window.solana?.isPhantom){ statusEl.textContent = 'Phantom detected — click Connect'; }
    </script>

<!-- Background warp stars -->
<canvas id="nx-warp" aria-hidden="true"></canvas>
<script>
(function(){
  const cnv = document.getElementById('nx-warp');
  const ctx = cnv.getContext('2d', { alpha: true });

  // ------- TUNEABLES -------
  const STAR_COUNT = 120;          // keep modest
  const BASE_SPEED = 0.01;        // subtle zoom
  const MAX_Z = 1.0;               // furthest depth
  const MIN_Z = 0.05;              // nearest before reset
  const FOV = 350;                 // perspective strength
  const STAR_BASE_SIZE = 0.7;      // minimal dot size
  const STAR_MAX_SIZE = 2.2;       // clamp growth
  const COLOR = getComputedStyle(document.documentElement)
                .getPropertyValue('--nx-cyan')?.trim() || '#6ff3ff';
  // gentle outward swirl (0 = straight)
  const SWIRL = 0.002;

  // Reduced motion = slower & fewer
  const prefersReduce = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  const SPEED = prefersReduce ? BASE_SPEED*0.5 : BASE_SPEED;
  const COUNT = prefersReduce ? Math.max(60, STAR_COUNT*0.6) : STAR_COUNT;

  let W=0,H=0, CX=0, CY=0, running=true;

  function resize(){
    const dpr = Math.max(1, window.devicePixelRatio || 1);
    W = cnv.clientWidth = window.innerWidth;
    H = cnv.clientHeight = window.innerHeight;
    cnv.width  = Math.floor(W * dpr);
    cnv.height = Math.floor(H * dpr);
    ctx.setTransform(dpr,0,0,dpr,0,0);
    CX = W/2; CY = H/2;
  }
  window.addEventListener('resize', resize, { passive:true });
  resize();

  // Create stars in normalized space (-1..1 for x,y, depth 0..1)
  const stars = Array.from({length: COUNT}, seedStar);

  function seedStar(){
    // bias toward center a touch so it feels deeper
    const angle = Math.random()*Math.PI*2;
    const radius = Math.pow(Math.random(), 0.85); // 0..1, more near center
    const x = Math.cos(angle) * radius;
    const y = Math.sin(angle) * radius;
    const z = Math.random()*(MAX_Z-MIN_Z) + MIN_Z;
    return { x, y, z, px:0, py:0 }; // px/py keep prior screen pos for a tiny streak
  }

  function project(s){
    // perspective projection
    const scale = FOV / (FOV + (s.z * FOV));
    const sx = CX + s.x * scale * W; // scale by viewport width so it breathes with size
    const sy = CY + s.y * scale * W;
    const r  = Math.min(STAR_MAX_SIZE, STAR_BASE_SIZE + (1 - s.z) * 2.0);
    return { sx, sy, r };
  }

  function update(dt){
    const swirl = SWIRL;
    for (let s of stars){
      // gentle spiral: rotate (x,y) slightly based on depth
      const rot = swirl * (1 - s.z);
      const nx = s.x * Math.cos(rot) - s.y * Math.sin(rot);
      const ny = s.x * Math.sin(rot) + s.y * Math.cos(rot);
      s.x = nx; s.y = ny;

      // move toward camera
      s.z -= SPEED * dt;
      if (s.z <= MIN_Z){
        // reset to far plane keeping direction random
        const n = seedStar(); s.x=n.x; s.y=n.y; s.z=MAX_Z; s.px=0; s.py=0;
      }
    }
  }

  function draw(){
    ctx.clearRect(0,0,W,H);
    ctx.globalCompositeOperation = 'lighter';
    for (let s of stars){
      const p = project(s);
      // faint streak from previous pos -> current (only when we have a prior)
      if (s.px && s.py){
        ctx.beginPath();
        ctx.moveTo(s.px, s.py);
        ctx.lineTo(p.sx, p.sy);
        ctx.strokeStyle = COLOR + 'AA'; // subtle alpha
        ctx.lineWidth = 0.6;
        ctx.stroke();
      }
      // star dot
      ctx.beginPath();
      ctx.arc(p.sx, p.sy, p.r, 0, Math.PI*2);
      ctx.fillStyle = COLOR;
      ctx.globalAlpha = 0.65 + (1 - s.z) * 0.25; // nearer = slightly brighter
      ctx.fill();
      ctx.globalAlpha = 1;

      s.px = p.sx; s.py = p.sy;
    }
    ctx.globalCompositeOperation = 'source-over';
  }

  // Manage animation time for consistent speed
  let lastT = performance.now();
  function loop(t){
    if(!running) return;
    const dt = Math.min(60, (t - lastT)) / 16.6667; // normalize to ~frames
    lastT = t;
    update(dt);
    draw();
    requestAnimationFrame(loop);
  }

  // Layering styles: full-viewport, behind content, click-through
  Object.assign(cnv.style, {
    position:'fixed', inset:'0', zIndex:'0',
    pointerEvents:'none', background:'transparent'
  });
  // Ensure your main content has a higher stacking context than 0 if needed.
  // (Your panels/header already do.)

  // Pause when tab hidden to save cycles
  document.addEventListener('visibilitychange', ()=>{ running = !document.hidden; if(running){ lastT=performance.now(); requestAnimationFrame(loop);} });

  requestAnimationFrame(loop);
})();
</script>
<script>
  // Helper: robust Phantom resolver
  function getPhantomProvider() {
    // 1) Mobile/in-app
    if (window.phantom?.solana) return window.phantom.solana;

    const w = window.solana;
    // 2) Single provider case
    if (w?.isPhantom) return w;

    // 3) Multi-provider (some wallets expose an array)
    if (Array.isArray(w?.providers)) {
      const ph = w.providers.find(p => p?.isPhantom);
      if (ph) return ph;
    }
    return null;
  }

  connectBtn.addEventListener('click', async () => {
    const provider = getPhantomProvider();

    // If loading from file:// without extension access, this will be null.
    if (!provider) {
      setDisconnected('Phantom not injected. Serve via http:// or enable “Allow access to file URLs”.');
      // Optional: open install page as fallback
      // window.open('https://phantom.app/', '_blank');
      return;
    }

    try {
      // Listen once (optional but handy)
      provider.on?.('connect', () => {/* you could flash a toast here */});
      provider.on?.('disconnect', () => { clear(); setDisconnected('Disconnected'); });

      const resp = await provider.connect({ onlyIfTrusted: false });
      const pk = resp?.publicKey?.toString?.() || provider?.publicKey?.toString?.() || '';
      if (remember.checked) save(pk);
      setConnected(pk);

      const next = new URLSearchParams(location.search).get('next');
      if (next) location.href = next;
    } catch (err) {
      setDisconnected('Connection cancelled');
    }
  });
</script>
<script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>

<script>
  async function connectWallet() {
    if (window.solana && window.solana.isPhantom) {
      try {
        const resp = await window.solana.connect({ onlyIfTrusted: false });
        const pubkey = resp.publicKey.toString();

        // Save wallet to localStorage (so other pages see it)
        localStorage.setItem("nebula:wallet", pubkey);

        // ✅ Redirect to homepage
        window.location.href = "NebulaX.html";
      } catch (err) {
        console.error("Wallet connect canceled", err);
      }
    } else {
      alert("Phantom Wallet not found. Please install Phantom.");
      window.open("https://phantom.app/", "_blank");
    }
  }

  // Wire up your connect button
  document.getElementById("connect-btn")
    ?.addEventListener("click", connectWallet);
</script>

  </body>
</html>
