<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>NEBULAX • Watchlist</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
<script src="nx-theme.js"></script>
<style>
  :root {
    --nx-cyan:#00e6ff; --nx-dark:#0a0d1b; --nx-dark-2:#12152a;
    --nx-border:#1e2747; --nx-text:#e0e7ff;
  }
  html[data-theme="amber"]{ --nx-cyan:#ffb020; --nx-dark:#0b0b14; --nx-dark-2:#15162a; --nx-border:#2a2647; --nx-text:#ffeccc; }
  html[data-theme="violet"]{ --nx-cyan:#b69cff; --nx-dark:#0a0a16; --nx-dark-2:#131329; --nx-border:#27224a; --nx-text:#eae4ff; }
  html[data-theme="neon"]{ --nx-cyan:#55ffda; --nx-dark:#070b12; --nx-dark-2:#0d1220; --nx-border:#1a243a; --nx-text:#dbfff7; }

  .nx-tab { padding:.4rem .6rem; border-radius:.7rem; border:1px solid transparent; font-size:.85rem; }
  .nx-tab.active { border-color:var(--nx-border); background:rgba(255,255,255,.03); color:var(--nx-cyan); }
  .nx-btn { font-size:.8rem; padding:.35rem .6rem; border-radius:.6rem; border:1px solid var(--nx-border); }
  .nx-btn-outline { font-size:.8rem; padding:.35rem .6rem; border-radius:.6rem; border:1px dashed var(--nx-border); background:transparent; }
  input::placeholder { color: #7a86a8; }
</style>
    <style>
      :root{
        --nx-cyan:#00e6ff;
        --nx-dark:#0a0d1b;
        --nx-dark-2:#12152a;
        --nx-border:#1e2747;
        --nx-text:#e0e7ff;
        --page-max: 1400px; /* match other pages */
      }
      html,body{height:100%; background:var(--nx-dark); font-family:'Orbitron','ui-monospace','SFMono-Regular',monospace; color:var(--nx-text);}  
      .page-wrap{max-width:var(--page-max); margin:18px auto; padding:0 12px;}

      /* Panels */
      .nx-panel{ background:rgba(16,20,40,.92); border:1px solid var(--nx-border); box-shadow: inset 0 0 10px rgba(0,230,255,.18), 0 0 12px rgba(0,230,255,.08); backdrop-filter: blur(8px); border-radius: 16px; }
      .nx-title{color:#ffeb3b;text-shadow:0 0 3px #ffeb3b;}
      .tabnums{font-variant-numeric: tabular-nums;}

      /* Buttons */
      .nx-btn{ border-radius:14px; padding:.42rem .72rem; font-weight:700; transition:transform .05s ease, opacity .18s ease, box-shadow .18s ease; border:1px solid var(--nx-border); background:var(--nx-dark-2); color:var(--nx-text);} 
      .nx-btn:hover{opacity:.95}
      .nx-btn:active{transform:translateY(1px)}
      .nx-btn-cyan{ background:var(--nx-cyan); color:#0b101b; border-color:#0d3540; box-shadow:0 0 10px rgba(0,230,255,.3); }

      /* Inputs */
      .nx-input{ width:100%; border-radius:12px; border:1px solid var(--nx-border); background:var(--nx-dark-2); color:var(--nx-text); padding:.55rem .7rem; outline:none; }
      .nx-input:focus{border-color:var(--nx-cyan); box-shadow:0 0 0 2px rgba(0,230,255,.14)}

      /* Table */
      .nx-table{ width:100%; border-collapse:separate; border-spacing:0; }
      .nx-th, .nx-td{ padding:10px 10px; text-align:left; border-bottom:0; }
      thead .nx-th{ position:sticky; top:0; z-index:20; user-select:none; cursor:pointer; background:rgba(32,36,64,.95); color:#ffeb3b; text-shadow:0 0 3px #ffeb3b; border-bottom:1px solid var(--nx-border); }
      tbody tr{ position:relative; }
      tbody tr::after{ content:""; position:absolute; left:0; right:0; bottom:0; height:1px; background:#333a66; pointer-events:none; }
      tbody tr:hover{ background:rgba(10,14,28,.6); box-shadow: inset 0 0 0 1px rgba(0,230,255,.08); }
      .sortable::after{ content:""; margin-left:6px; border:4px solid transparent; border-top-color:#ffeb3b; display:inline-block; transform:translateY(2px); opacity:.4; }
      .sortable.asc::after{ border-top-color:transparent; border-bottom-color:#ffeb3b; transform:translateY(-2px); opacity:1; }
      .sortable.desc::after{ border-top-color:#ffeb3b; opacity:1; }

      .pill{ display:inline-block; padding:2px 8px; border-radius:999px; font-size:11px; }
      .pill.green{ background:rgba(16,185,129,.18); color:#34d399; }
      .pill.red{ background:rgba(239,68,68,.18); color:#f87171; }
      .pill.cyan{ background:rgba(0,230,255,.18); color:#6ff3ff; }

      /* Popovers / Modals */
      .popover{position:absolute; z-index:1000; border:1px solid var(--nx-border); background:rgba(13,16,34,.98); box-shadow:0 10px 30px rgba(0,0,0,.4); border-radius:12px;}
      .modal-fx{ position:fixed; inset:0; display:grid; place-items:center; z-index:2100; background:rgba(0,0,0,.55); padding:12px; }
      .modal-fx.hidden{ display:none !important; }

      /* SEARCH dropdown (shared style) */
      #search-wrap:focus-within .nx-input{ border-color:var(--nx-cyan); box-shadow:0 0 0 2px rgba(0,230,255,.14); }
      .search-row{ display:flex; align-items:center; gap:.75rem; padding:.45rem .6rem; border-radius:10px; }
      .search-row:hover{ background: var(--nx-dark-2); }
      .search-icon{ height:2rem; width:2rem; display:flex; align-items:center; justify-content:center; border-radius:8px; background:var(--nx-dark-2); }
      .search-grid{ display:grid; grid-template-columns: 1fr auto auto auto; gap:.75rem; align-items:center; min-width:0; }
      .search-name{ min-width:0; }
      .search-name .ticker{ font-size:11px; color:#8b97c9; }
      .search-metric{ font-size:11px; color:#9fb3ff; white-space:nowrap; }
      .search-active{ outline:2px solid var(--nx-cyan); outline-offset:2px; }

      /* Scrollbar */
      ::-webkit-scrollbar{width:10px;height:10px}
      ::-webkit-scrollbar-track{background:var(--nx-dark-2);border:1px solid #1b2450;border-radius:6px;box-shadow:inset 0 0 8px rgba(0,230,255,.12)}
      ::-webkit-scrollbar-thumb{border-radius:6px;background:var(--nx-cyan);box-shadow:0 0 8px rgba(0,230,255,.35);border:2px solid var(--nx-dark-2)}
      ::-webkit-scrollbar-thumb:hover{background:#6ff3ff}
      *{scrollbar-width:thin; scrollbar-color: var(--nx-cyan) var(--nx-dark-2)}
    </style>
  </head>
  <body>
    <!-- Header -->
    <header class="sticky top-0 z-[1000] isolate border-b border-[var(--nx-border)] bg-[rgba(10,13,27,0.9)] backdrop-blur-sm">
      <div class="page-wrap h-7 px-1 flex items-center justify-between">
        <div class="flex items-center gap-3">
          <a href="NebulaX.html" class="flex items-center gap-2">
            <img src="NebulaX-logo.png" class="h-6 w-6 rounded-md" alt="NebulaX"/>
            <span class="font-bold tracking-wide" style="text-shadow:0 0 2px var(--nx-cyan);">NEBULAX</span>
          </a>
          <nav class="hidden sm:flex items-center gap-2 ml-2">
            <a class="nx-btn px-2 py-1 text-xs" href="NebulaX.html">Home</a>
            <a class="nx-btn px-2 py-1 text-xs" href="NewPairs-official.html">New Pairs</a>
            <a class="nx-btn px-2 py-1 text-xs" href="Trending.html">Trending</a>
            <a class="nx-btn px-2 py-1 text-xs" href="portfolio_official_v_2_fixed.html">Portfolio</a>
            <a class="nx-btn px-2 py-1 text-xs" href="Adrenaline-official.html">Adrenaline</a>
            <a class="nx-btn px-2 py-1 text-xs" href="nebula_x_store_official.html">Store</a>
          </nav>
        </div>

        <!-- SEARCH -->
        <div id="search-wrap" class="relative w-[26rem] max-w-[60vw]">
          <input id="search-input" class="nx-input" placeholder="Search markets... /" autocomplete="off"/>
          <div id="search-dd" class="popover hidden mt-1 w-full max-h-[22rem] overflow-auto p-2"></div>
        </div>

        <!-- Wallet -->
        <div class="flex items-center gap-2">
          <button id="wallet-btn" class="nx-btn"><i data-lucide="wallet" class="w-3 h-3 mr-2"></i> Bal: 0.214 SOL</button>
        </div>
      </div>
    </header>

    <div class="page-wrap">
      <main class="mt-3 grid grid-cols-1 lg:grid-cols-[1fr_360px] gap-3">
        <!-- LEFT: Watchlist table -->
        <section class="nx-panel p-3">
          <div class="flex items-center justify-between mb-2">
            <div>
              <div class="text-xl nx-title">Watchlist</div>
              <div class="text-xs text-zinc-400">Your saved markets. Stored in localStorage so they persist between sessions.</div>
            </div>
            <div class="flex gap-2">
              <button id="btn-clear" class="nx-btn">Clear All</button>
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mb-2">
            <div>
              <label class="text-xs text-zinc-400 block mb-1">Filter (pair)</label>
              <input id="flt-pair" class="nx-input" placeholder="e.g. WIF/SOL"/>
            </div>
            <div>
              <label class="text-xs text-zinc-400 block mb-1">Only Verified (mock)</label>
              <select id="flt-verified" class="nx-input">
                <option value="any">Any</option>
                <option value="yes">Yes</option>
                <option value="no">No</option>
              </select>
            </div>
          </div>

          <div class="themed-scroll max-h-[560px] overflow-auto rounded-[12px] border border-[var(--nx-border)]">
            <table class="nx-table" id="wl-table">
              <thead>
                <tr>
                  <th class="nx-th sortable" data-sort="pair" style="width:220px;">Pair</th>
                  <th class="nx-th sortable" data-sort="mc">Market Cap</th>
                  <th class="nx-th sortable" data-sort="vol">24h Vol</th>
                  <th class="nx-th sortable" data-sort="liq">Liquidity</th>
                  <th class="nx-th sortable" data-sort="chg">24h %</th>
                  <th class="nx-th sortable" data-sort="holders">Holders</th>
                  <th class="nx-th" style="width:210px;">Actions</th>
                </tr>
              </thead>
              <tbody id="wl-body"></tbody>
            </table>
          </div>
        </section>

        <!-- RIGHT: Quick actions -->
        <aside class="nx-panel p-3">
          <div class="nx-panel p-3 mb-3">
            <div class="text-sm font-semibold mb-2">Quick Add</div>
            <div class="space-y-2">
              <input id="qa-pair" class="nx-input" placeholder="Mint address (preferred) or PAIR like WIF/SOL"/>
              <button id="qa-add" class="nx-btn nx-btn-cyan w-full">Add to Watchlist</button>
              <div class="text-xs text-zinc-400">Tip: paste a Solana mint address to add by mint. (mock lookup)</div>
            </div>
          </div>

          <div class="nx-panel p-3">
            <div class="text-sm font-semibold mb-2">Alerts Preview</div>
            <div id="alerts-mini" class="text-xs text-zinc-400">No alerts yet.</div>
          </div>
        </aside>
      </main>

      <footer class="mt-3 mb-4">
        <div class="nx-panel px-3 py-2 text-xs flex items-center justify-between">
          <div class="flex items-center gap-3">
            <span class="text-zinc-400">Status:</span>
            <span class="text-emerald-400">Idle (mock)</span>
          </div>
          <div>&copy; <span id="year"></span> NebulaX • Watchlist • Front-end mock</div>
        </div>
      </footer>
    </div>

    <!-- Wallet Modal Popup -->
    <div id="wallet-modal" class="modal-fx hidden">
      <div class="nx-panel w-[380px] max-w-[90vw] p-4">
        <div class="flex items-center justify-between mb-3">
          <div class="text-lg font-semibold">Wallet</div>
          <button class="nx-btn nx-btn-cyan px-2 py-1 text-xs" onclick="document.getElementById('wallet-modal').classList.add('hidden')">Close</button>
        </div>
        <div class="grid grid-cols-2 gap-2 text-sm mb-3">
          <div class="nx-panel p-3">
            <div class="text-xs text-zinc-400 mb-1">Total Balance</div>
            <div class="font-semibold text-base" id="wallet-total">0.000 SOL</div>
          </div>
          <div class="nx-panel p-3">
            <div class="text-xs text-zinc-400 mb-1">Available</div>
            <div class="font-semibold text-base" id="wallet-available">0.000 SOL</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-2 mb-3">
          <button id="wd-open" class="nx-btn">Withdraw</button>
          <button id="dp-open" class="nx-btn nx-btn-cyan">Deposit</button>
        </div>
        <div class="grid grid-cols-2 gap-2">
          <button id="wallet-connect" class="nx-btn nx-btn-cyan">Connect</button>
          <button id="wallet-disconnect" class="nx-btn">Disconnect</button>
        </div>
      </div>
    </div>
    <div id="deposit" class="modal-fx hidden">
      <div class="nx-panel w-[360px] max-w-[90vw] p-3">
        <div class="flex items-center justify-between mb-2"><div class="font-semibold">Deposit</div><button class="nx-btn nx-btn-cyan px-2 py-1 text-xs" onclick="document.getElementById('deposit').classList.add('hidden')">Close</button></div>
        <div class="text-sm text-zinc-400 mb-2">Send SOL to your platform wallet address:</div>
        <div class="nx-panel p-2 text-xs break-words" id="deposit-addr">Do7AJiNrJvFVGTUCw8XvVhRGVBVLTHcBvEnfi3K68gze</div>
        <button class="nx-btn nx-btn-cyan w-full mt-3" id="copy-deposit-btn">Copy Address</button>
      </div>
    </div>
    <div id="withdraw" class="modal-fx hidden">
      <div class="nx-panel w-[360px] max-w-[90vw] p-3">
        <div class="flex items-center justify-between mb-2"><div class="font-semibold">Withdraw</div><button class="nx-btn nx-btn-cyan px-2 py-1 text-xs" onclick="document.getElementById('withdraw').classList.add('hidden')">Close</button></div>
        <div class="space-y-2">
          <input class="nx-input" placeholder="Destination SOL address"/>
          <div class="grid grid-cols-3 gap-2">
            <input class="nx-input col-span-2" placeholder="Amount"/>
            <select class="nx-input"><option>SOL</option><option>USD</option></select>
          </div>
          <button class="nx-btn nx-btn-cyan w-full">Submit</button>
        </div>
      </div>
    </div>

    <script>
      /* Icons + Year */
      if (window.lucide && typeof window.lucide.createIcons==='function'){ window.lucide.createIcons(); }
      document.getElementById('year').textContent = new Date().getFullYear();

      /* Back */
      document.getElementById('back-btn')?.addEventListener('click', (e)=>{ e.preventDefault(); history.back(); });

      /* ===== SEARCH (shared behavior) ===== */
      const SEARCH_DATA = [
        {icon:'◎', name:'SOL / USDC', ticker:'SOL',  mc:'$13.2B', v:'$980M', l:'$120M'},
        {icon:'◈', name:'WIF / SOL',  ticker:'WIF',  mc:'$4.2B',  v:'$120M', l:'$32M'},
        {icon:'◈', name:'BONK / SOL', ticker:'BONK', mc:'$1.8B',  v:'$88M',  l:'$20M'},
      ];
      const sWrap=document.getElementById('search-wrap');
      const sIn=document.getElementById('search-input');
      const sDD=document.getElementById('search-dd');
      let activeIndex=-1, currentHits=[];
      const debounce=(fn,ms=150)=>{ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a),ms); }; };
      function renderSearch(q){
        const query=(q||'').trim().toLowerCase();
        currentHits = query? SEARCH_DATA.filter(o => (o.name+o.ticker).toLowerCase().includes(query)) : [];
        sDD.innerHTML=''; activeIndex=-1;
        if(!currentHits.length){ sDD.classList.add('hidden'); return; }
        sDD.classList.remove('hidden');
        sDD.insertAdjacentHTML('beforeend','<div class="px-3 py-2 text-[11px] uppercase tracking-wide text-zinc-400 border-b border-[var(--nx-border)]">Results</div>');
        currentHits.forEach((o,i)=>{
          const row=document.createElement('button');
          row.type='button'; row.className='search-row w-full'; row.dataset.index=i;
          row.innerHTML=`
            <div class="search-icon">${o.icon}</div>
            <div class="search-grid min-w-0 flex-1">
              <div class="search-name min-w-0">
                <div class="truncate">${o.name}</div>
                <div class="ticker">${o.ticker}</div>
              </div>
              <div class="search-metric tabnums">MC <span class="font-semibold">${o.mc}</span></div>
              <div class="search-metric tabnums">V <span class="font-semibold">${o.v}</span></div>
              <div class="search-metric tabnums">L <span class="font-semibold">${o.l}</span></div>
            </div>`;
          row.addEventListener('click',()=>selectHit(i));
          sDD.appendChild(row);
        });
      }
      const doRender = debounce(()=>renderSearch(sIn.value),120);
      sIn.addEventListener('input', doRender);
      sIn.addEventListener('focus', doRender);
      document.addEventListener('click', (e)=>{ if(!sWrap.contains(e.target)) sDD.classList.add('hidden'); });
      sIn.addEventListener('keydown',(e)=>{
        if(sDD.classList.contains('hidden')) return;
        const rows=[...sDD.querySelectorAll('.search-row')]; if(!rows.length) return;
        if(e.key==='ArrowDown'){ e.preventDefault(); rows.forEach(r=>r.classList.remove('search-active')); activeIndex=(activeIndex+1)%rows.length; rows[activeIndex].classList.add('search-active'); rows[activeIndex].scrollIntoView({block:'nearest'}); }
        else if(e.key==='ArrowUp'){ e.preventDefault(); rows.forEach(r=>r.classList.remove('search-active')); activeIndex=(activeIndex-1+rows.length)%rows.length; rows[activeIndex].classList.add('search-active'); rows[activeIndex].scrollIntoView({block:'nearest'}); }
        else if(e.key==='Enter'){ e.preventDefault(); if(activeIndex<0) activeIndex=0; selectHit(activeIndex); }
        else if(e.key==='Escape'){ sDD.classList.add('hidden'); }
      });
      function selectHit(i){ const hit=currentHits[i]; if(!hit) return; sDD.classList.add('hidden'); sIn.value=''; alert('Navigate to '+hit.name+' (mock)'); }

      /* ===== Wallet modal + modals ===== */
      const wBtn=document.getElementById('wallet-btn'); const wModal=document.getElementById('wallet-modal');
      
      // Update wallet display with real balance
      function updateWalletDisplay(){
        const balance = window.NXWallet?.getBalance?.();
        const sol = balance ? balance.toFixed(3) : '0.000';
        document.getElementById('wallet-total').textContent = sol + ' SOL';
        document.getElementById('wallet-available').textContent = sol + ' SOL';
      }
      
      wBtn?.addEventListener('click',(e)=>{ e.stopPropagation(); updateWalletDisplay(); wModal.classList.remove('hidden'); });
      wModal?.addEventListener('click',(e)=>{ if(e.target===wModal) wModal.classList.add('hidden'); });
      document.getElementById('dp-open')?.addEventListener('click',()=>{ wModal.classList.add('hidden'); document.getElementById('deposit').classList.remove('hidden'); });
      document.getElementById('wd-open')?.addEventListener('click',()=>{ wModal.classList.add('hidden'); document.getElementById('withdraw').classList.remove('hidden'); });
      
      // Wallet connect/disconnect
      document.getElementById('wallet-connect')?.addEventListener('click',async()=>{ 
        const prov = (window.phantom?.solana) || window.solana;
        try { await prov?.connect?.(); } catch(e) { console.log('Connect cancelled'); }
      });
      document.getElementById('wallet-disconnect')?.addEventListener('click',async()=>{ 
        const prov = (window.phantom?.solana) || window.solana;
        try { await prov?.disconnect?.(); } catch(e) { console.log('Disconnect error'); }
      });
      
      // Deposit address copy
      const copyBtn = document.getElementById('copy-deposit-btn');
      const depositAddr = document.getElementById('deposit-addr');
      copyBtn?.addEventListener('click',()=>{ 
        const addr = depositAddr.textContent;
        navigator.clipboard.writeText(addr).then(()=>{ copyBtn.textContent='Copied!'; setTimeout(()=>{ copyBtn.textContent='Copy Address'; },2000); }); 
      });
      
      // Close modals on click outside
      document.getElementById('deposit')?.addEventListener('click',(e)=>{ if(e.target.id==='deposit') e.target.classList.add('hidden'); });
      document.getElementById('withdraw')?.addEventListener('click',(e)=>{ if(e.target.id==='withdraw') e.target.classList.add('hidden'); });
      
      // Listen for balance changes
      window.addEventListener('nebula:sol:changed',(e)=>{ if(!wModal.classList.contains('hidden')) updateWalletDisplay(); });

      /* ===== Watchlist state (localStorage) ===== */
      const STORAGE_KEY='nebula_watchlist_v1';
      const ALERTS_KEY='nebula_alerts_v1'; // { pair: [rules] }
      function loadJSON(key, fallback){ try{ return JSON.parse(localStorage.getItem(key)) ?? fallback; }catch{return fallback;} }
      function saveJSON(key, val){ localStorage.setItem(key, JSON.stringify(val)); }

      let WATCH = new Map(Object.entries(loadJSON(STORAGE_KEY, {}))); // Map<pair, data>
      let ALERTS = new Map(Object.entries(loadJSON(ALERTS_KEY, {})));

      // seed sample if empty
      if(WATCH.size===0){
        [
          {pair:'WIF/SOL', mc:4200000000, vol:120000000, liq:32000000, chg:8.3, holders:155000, verified:true},
          {pair:'BONK/SOL', mc:1800000000, vol:88000000, liq:20000000, chg:-3.2, holders:300000, verified:true},
          {pair:'MINT:So1a…Mint', mint:'So1aMintMockxxxxxxxxxxxxxxxxxxxxxxx', mc:240000000, vol:14500000, liq:5200000, chg:12.5, holders:24000, verified:false},
        ].forEach(r=> WATCH.set(r.pair, r));
        persist();
      }

      const wlBody=document.getElementById('wl-body');
      let sortKey='pair', sortDir='asc';

      function fmtUSD(n){
        if(n>=1_000_000_000) return '$'+(n/1_000_000_000).toFixed(2)+'B';
        if(n>=1_000_000) return '$'+(n/1_000_000).toFixed(2)+'M';
        if(n>=1_000) return '$'+(n/1_000).toFixed(2)+'K';
        return '$'+(n||0);
      }

      function rowHTML(r){
        const rules = ALERTS.get(r.pair) || [];
        const ver = r.verified ? '<span class="pill cyan">Verified</span>' : '';
        const chg = (r.chg||0); const chgHTML = chg>=0? `<span class="pill green">+${chg}%</span>` : `<span class="pill red">${chg}%</span>`;
        const pairLabel = r.mint ? `${r.pair} <span class='text-zinc-400 text-xs'>(mint)</span>` : r.pair;
        return `
          <tr data-pair="${r.pair}">
            <td class="nx-td"><strong>${pairLabel}</strong> ${ver}</td>
            <td class="nx-td">${fmtUSD(r.mc)}</td>
            <td class="nx-td">${fmtUSD(r.vol)}</td>
            <td class="nx-td">${fmtUSD(r.liq)}</td>
            <td class="nx-td">${chgHTML}</td>
            <td class="nx-td tabnums">${(r.holders||0).toLocaleString()}</td>
            <td class="nx-td" style="display:flex; gap:6px;">
              <button class="nx-btn" data-act="open">Open</button>
              <button class="nx-btn" data-act="alerts">Alerts ${rules.length?`(${rules.length})`:''}</button>
              <button class="nx-btn" data-act="remove">Remove</button>
            </td>
          </tr>`;
      }

      function applyFilters(list){
        const q=document.getElementById('flt-pair').value.trim().toLowerCase();
        const v=document.getElementById('flt-verified').value;
        return list.filter(r=>{
          if(q && !r.pair.toLowerCase().includes(q)) return false;
          if(v==='yes' && !r.verified) return false;
          if(v==='no' && r.verified) return false;
          return true;
        });
      }

      function applySort(list){
        const cmp = {pair:(a,b)=>a.pair.localeCompare(b.pair), mc:(a,b)=>(a.mc||0)-(b.mc||0), vol:(a,b)=>(a.vol||0)-(b.vol||0), liq:(a,b)=>(a.liq||0)-(b.liq||0), chg:(a,b)=>(a.chg||0)-(b.chg||0), holders:(a,b)=>(a.holders||0)-(b.holders||0)}[sortKey] || ((a,b)=>0);
        const s = list.slice().sort(cmp);
        return sortDir==='asc'? s : s.reverse();
      }

      function updateSortHeaders(){
        document.querySelectorAll('th.sortable').forEach(th=>{
          th.classList.remove('asc','desc');
          if(th.dataset.sort===sortKey){ th.classList.add(sortDir); }
        });
      }

      function render(){
        const rows=[...WATCH.values()];
        const filtered=applyFilters(rows);
        const sorted=applySort(filtered);
        wlBody.innerHTML = sorted.map(rowHTML).join('') || `<tr><td class="nx-td" colspan="7"><div class="text-center text-zinc-400 py-3">No pairs yet. Use Quick Add.</div></td></tr>`;
        updateSortHeaders();
      }

      function persist(){ saveJSON(STORAGE_KEY, Object.fromEntries(WATCH)); saveJSON(ALERTS_KEY, Object.fromEntries(ALERTS)); }

      document.querySelectorAll('th.sortable').forEach(th=>{
        th.addEventListener('click',()=>{
          const key=th.dataset.sort;
          if(sortKey===key){ sortDir = (sortDir==='asc')?'desc':'asc'; } else { sortKey=key; sortDir='asc'; }
          render();
        });
      });

      ['flt-pair','flt-verified'].forEach(id=> document.getElementById(id).addEventListener('input', render));

      wlBody.addEventListener('click',(e)=>{
        const tr=e.target.closest('tr'); if(!tr) return;
        const pair=tr.getAttribute('data-pair');
        const actBtn=e.target.closest('button');
        if(!actBtn){ alert('Navigate to '+pair+' (mock)'); return; }
        const act=actBtn.getAttribute('data-act');
        if(act==='open'){ alert('Open '+pair+' (mock)'); }
        if(act==='remove'){ WATCH.delete(pair); persist(); render(); }
        if(act==='alerts'){ openAlerts(pair); }
      });

      function openAlerts(pair){
        const picked = prompt('Set rules comma-separated (e.g. whale_buy,volume_spike). Empty to clear.', (ALERTS.get(pair)||[]).join(','));
        if(picked===null) return;
        const arr = picked.split(',').map(s=>s.trim()).filter(Boolean);
        if(arr.length){ ALERTS.set(pair, arr); } else { ALERTS.delete(pair); }
        persist(); render(); pushAlertPreview(pair, arr);
      }

      function pushAlertPreview(pair, rules){
        const mini=document.getElementById('alerts-mini');
        const div=document.createElement('div');
        div.className='py-1 border-b border-[var(--nx-border)]';
        div.textContent=`${pair}: ${rules.length?rules.join(', '):'No rules'} (saved mock)`;
        mini.prepend(div); while(mini.children.length>12) mini.removeChild(mini.lastChild);
      }

      // Quick Add (mint or pair)
      document.getElementById('qa-add').addEventListener('click',()=>{
        const raw=document.getElementById('qa-pair').value.trim(); if(!raw){ alert('Enter mint address or PAIR like WIF/SOL'); return; }
        const base58=/^[1-9A-HJ-NP-Za-km-z]{32,44}$/;
        let rec;
        if(base58.test(raw)){
          const label = `MINT:${raw.slice(0,4)}…${raw.slice(-4)}`;
          rec={ pair: label, mint: raw, mc:0, liq:0, vol:0, chg:0, holders:0, verified:false };
        }else{
          rec={ pair: raw.toUpperCase(), mc:0, liq:0, vol:0, chg:0, holders:0, verified:false };
        }
        WATCH.set(rec.pair, rec); persist(); render();
        document.getElementById('qa-pair').value='';
      });

      // Clear
      document.getElementById('btn-clear').addEventListener('click',()=>{ if(!confirm('Clear entire watchlist?')) return; WATCH.clear(); persist(); render(); });

      render();
    </script>
<script>
/** ===== NebulaX Click-to-Coin Utilities ===== */
window.NX = window.NX || {};
NX.saveSelectedCoin = function(coin){
  try { localStorage.setItem('nebula_selected_coin', JSON.stringify(coin)); } catch(e){}
};
NX.goToCoin = function(coin){
  NX.saveSelectedCoin(coin);
  const pair = coin.pair || (coin.symbol ? (coin.symbol.toUpperCase()+'/SOL') : '');
  const mint = encodeURIComponent(coin.mint || '');
  const qp = `?pair=${encodeURIComponent(pair)}${mint ? `&mint=${mint}` : ''}`;
  location.href = `Coinpage-Official.html${pair ? qp : ''}`;
};
</script>

<script>
function nxOpenCoin({ pair, mint = '' }) {
  const url = `Coinpage-Official.html?pair=${encodeURIComponent(pair)}&mint=${encodeURIComponent(mint)}`;
  location.href = url;
}
</script>
<script>
/* === NebulaX Core (themes, header hydrate, routing hooks) === */
(function(){
  const UserStore={
    key:'nx_user',
    state:{ wallet:null, theme:'default', pfp:{type:'builtin',url:'/pfp/default.png'} },
    load(){ try{ Object.assign(this.state, JSON.parse(localStorage.getItem(this.key)||'{}')); }catch{} },
    save(){ localStorage.setItem(this.key, JSON.stringify(this.state)); }
  };
  UserStore.load();

  const Theme={
    init(){
      const t = UserStore.state.theme || 'default';
      document.documentElement.setAttribute('data-theme', t);
      const sel = document.getElementById('nx-theme');
      if (sel) sel.value = t;
      sel?.addEventListener('change', (e)=>{
        const v=e.target.value;
        document.documentElement.setAttribute('data-theme', v);
        UserStore.state.theme=v; UserStore.save();
      });
    }
  };

  const Header={
    initActiveTab(){
      const here = location.pathname.replace(/\/+$/,'') || '/NebulaX.html';
      document.querySelectorAll('.nx-tab').forEach(a=>{
        const route = a.getAttribute('data-route');
        if (!route) return;
        if (route===here) a.classList.add('active');
        else a.classList.remove('active');
        a.addEventListener('click',(e)=>{
          // allow normal navigation
        });
      });
    },
    initSearch(){
      const input = document.getElementById('nx-search');
      const btn   = document.getElementById('nx-search-btn');
      if(!input||!btn) return;
      const go = ()=>{
        const q = (input.value||'').trim();
        if(!q) return;
        // Route to coin page convention: /Coinpage-Official.html?query=...
        location.href = `/Coinpage-Official.html?query=${encodeURIComponent(q)}`;
      };
      btn.addEventListener('click', go);
      input.addEventListener('keydown', (e)=>{ if(e.key==='Enter') go(); });
    },
    initPfp(){
      const img = document.getElementById('nx-pfp');
      if(img) img.src = (UserStore.state.pfp?.url)||'/pfp/default.png';
      const btn = document.getElementById('nx-profile');
      btn?.addEventListener('click',()=>{
        // simple MVP: cycle built-ins; later open profile modal
        const choices=['/pfp/default.png','/pfp/nx01.png','/pfp/nx02.png'];
        const idx = Math.max(0, choices.indexOf(UserStore.state.pfp?.url));
        const next = choices[(idx+1)%choices.length];
        UserStore.state.pfp={type:'builtin',url:next}; UserStore.save();
        if(img) img.src=next;
      });
    },
    initStore(){
      const a = document.getElementById('nx-store');
      if(!a) return;
      // keep as a link; if you make a modal later, hydrate here
    },
    initWallet(){
      const w = document.getElementById('nx-wallet');
      w?.addEventListener('click', ()=>{
        // hook your wallet adapter here
        alert('Connect wallet (hook your adapter)');
      });
    },
    mount(){ this.initActiveTab(); this.initSearch(); this.initPfp(); this.initStore(); this.initWallet(); }
  };

  document.addEventListener('DOMContentLoaded', ()=>{
    Theme.init();
    Header.mount();
  });
})();
</script>

  </body>
</html>
