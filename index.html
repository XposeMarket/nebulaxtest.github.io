<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NebulaX • Connect Wallet</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{ --nx-cyan:#00e6ff; --nx-dark:#0a0d1b; --nx-dark-2:#12152a; --nx-border:#1e2747; --nx-text:#e0e7ff; }
    html,body{height:100%;background:var(--nx-dark);color:var(--nx-text);font-family:'Orbitron','ui-monospace','SFMono-Regular',monospace}
    .nx-panel{ background:rgba(16,20,40,.92); border:1px solid var(--nx-border); box-shadow: inset 0 0 10px rgba(0,230,255,.18), 0 0 12px rgba(0,230,255,.08); backdrop-filter: blur(8px); border-radius: 16px; }
    .nx-btn{ border-radius:14px; padding:.7rem 1rem; font-weight:800; transition:transform .05s ease, opacity .18s ease, box-shadow .18s ease; border:1px solid var(--nx-border); background:var(--nx-dark-2); color:var(--nx-text);} 
    .nx-btn:hover{opacity:.95}
    .nx-btn:active{transform:translateY(1px)}
    .nx-btn-cyan{ background:var(--nx-cyan); color:#041018; border-color:#0d3540; box-shadow:0 0 10px rgba(0,230,255,.3); }
    /* Decorative starfield background */
    .starfield{ position:fixed; inset:0; z-index:-1; overflow:hidden; pointer-events:none; }
    .stars,.stars2{ position:absolute; inset:-10% -10%; }
    .stars::before,.stars2::before{ content:""; position:absolute; top:0; left:0; width:2px; height:2px; background:transparent; box-shadow:
      12vw 8vh #cfe8ff, 22vw 18vh #b7d4ff, 34vw 10vh #e0f3ff, 48vw 22vh #c8e7ff, 60vw 6vh #e6faff,
      72vw 16vh #d7efff, 84vw 12vh #c2e3ff, 18vw 26vh #dff6ff, 5vw 18vh #b9d7ff, 28vw 30vh #cde6ff,
      40vw 26vh #e1f4ff, 52vw 32vh #c9e8ff, 66vw 28vh #d4eeff, 78vw 34vh #c6e5ff, 90vw 22vh #e8fbff,
      8vw 40vh #cfe8ff, 24vw 44vh #e0f3ff, 56vw 46vh #c2e3ff, 70vw 40vh #dff6ff, 86vw 44vh #cde6ff,
      12vw 56vh #e1f4ff, 30vw 60vh #c9e8ff, 48vw 58vh #d4eeff, 62vw 64vh #c6e5ff, 80vw 60vh #e8fbff,
      16vw 72vh #cfe8ff, 36vw 76vh #b7d4ff, 50vw 70vh #e0f3ff, 68vw 76vh #c8e7ff, 88vw 72vh #e6faff,
      22vw 86vh #d7efff, 42vw 90vh #c2e3ff, 64vw 88vh #dff6ff, 76vw 92vh #b9d7ff, 8vw 88vh #cde6ff; opacity:.9; }
    .stars2::before{ width:3px; height:3px; opacity:.7; box-shadow:
      15vw 14vh #e8fbff, 38vw 20vh #d4eeff, 58vw 18vh #c2e3ff, 74vw 24vh #c9e8ff, 92vw 16vh #e1f4ff,
      26vw 52vh #c6e5ff, 44vw 48vh #e8fbff, 68vw 54vh #cfe8ff, 82vw 50vh #b7d4ff,
      34vw 82vh #e0f3ff, 56vw 78vh #c8e7ff, 72vw 84vh #e6faff, 10vw 74vh #d7efff, 20vw 68vh #c2e3ff,
      90vw 90vh #dff6ff, 54vw 92vh #b9d7ff, 6vw 62vh #cde6ff, 12vw 24vh #e1f4ff; }
    @keyframes driftSlow { from{ transform:translateY(-1.5%)} to{ transform:translateY(1.5%)} }
    .stars{ animation: driftSlow 38s ease-in-out infinite alternate; }
    .stars2{ animation: driftSlow 52s ease-in-out infinite alternate; }
    @media (prefers-reduced-motion: reduce){ .stars,.stars2{ animation:none } }
  </style>
</head>
<body>
  <div class="starfield"><div class="stars"></div><div class="stars2"></div></div>

  <main class="min-h-full grid place-items-center p-4">
    <section class="nx-panel w-full max-w-[480px] p-5">
      <header class="flex items-center gap-3">
        <img src="NebulaX-logo.png" class="h-8 w-8 rounded-md" alt="NebulaX"/>
        <div>
          <h1 class="text-lg font-bold tracking-wide" style="text-shadow:0 0 2px var(--nx-cyan);">NEBULAX</h1>
          <p class="text-xs text-zinc-400">Connect your wallet to continue</p>
        </div>
      </header>

      <div class="mt-5 grid gap-3">
        <label class="flex items-center gap-2 text-xs text-zinc-400">
          <input id="remember" type="checkbox" class="accent-cyan-500" checked>
          Remember this wallet on this device
        </label>

        <button id="connect-btn" class="nx-btn nx-btn-cyan">Connect Phantom</button>
        <button id="disconnect-btn" class="nx-btn hidden">Disconnect</button>
        <div id="wallet-status" class="text-xs text-zinc-400">Not connected</div>
      </div>

      <div class="mt-5 h-px bg-[var(--nx-border)]"></div>
      <p class="text-[11px] text-zinc-500 mt-3">We identify your account by your wallet address. No passwords are stored.</p>
      <footer class="mt-4 text-[11px] text-zinc-500 text-center">&copy; <span id="yr"></span> NebulaX</footer>
    </section>
  </main>

  <script>
    // Utilities
    const $ = (id)=>document.getElementById(id);
    const LKEY = "nebula:wallet";
    const remember = $("remember");
    const connectBtn = $("connect-btn");
    const disconnectBtn = $("disconnect-btn");
    const statusEl = $("wallet-status");
    $("yr").textContent = new Date().getFullYear();

    const short = (s)=> s ? (s.slice(0,4)+"…"+s.slice(-4)) : "";
    const save = (pk)=>{ try{ localStorage.setItem(LKEY, pk); }catch{} };
    const clear = ()=>{ try{ localStorage.removeItem(LKEY); }catch{} };

    function setConnected(pubkey){
      connectBtn.classList.add("hidden");
      disconnectBtn.classList.remove("hidden");
      statusEl.textContent = "Connected: " + short(pubkey);
      statusEl.classList.remove("text-zinc-400");
      statusEl.classList.add("text-emerald-400");
    }
    function setDisconnected(msg){
      disconnectBtn.classList.add("hidden");
      connectBtn.classList.remove("hidden");
      statusEl.textContent = msg || "Not connected";
      statusEl.classList.remove("text-emerald-400");
      statusEl.classList.add("text-zinc-400");
    }

    // Robust Phantom resolver
    function getPhantomProvider(){
      if (window.phantom?.solana) return window.phantom.solana;
      const w = window.solana;
      if (w?.isPhantom) return w;
      if (Array.isArray(w?.providers)){
        const ph = w.providers.find(p => p?.isPhantom);
        if (ph) return ph;
      }
      return null;
    }

    // Auto-reconnect on load if trusted previously
    window.addEventListener("load", async () => {
      const provider = getPhantomProvider();
      if (!provider){
        statusEl.textContent = "Phantom not found — install it to continue";
        return;
      }
      statusEl.textContent = "Phantom detected — click Connect";

      try{
        const resp = await provider.connect({ onlyIfTrusted: true });
        const pk = resp?.publicKey?.toString?.() || provider?.publicKey?.toString?.();
        if (pk){
          if (remember.checked) save(pk);
          setConnected(pk);
          const sp = new URLSearchParams(location.search);
          const next = sp.get("next");
          if (next) location.href = next;
        }
      }catch{ /* not yet trusted */ }
    });

    // Manual connect
    connectBtn.addEventListener("click", async () => {
      const provider = getPhantomProvider();
      if (!provider){
        statusEl.textContent = "Phantom not injected — open over http(s) or install Phantom";
        try{ window.open("https://phantom.app/", "_blank"); }catch{}
        return;
      }
      try{
        provider.on?.("disconnect", () => { clear(); setDisconnected("Disconnected"); });
        provider.on?.("accountChanged", (pk) => {
          if (!pk){ clear(); setDisconnected("Wallet switched/disconnected"); }
          else { const s = pk.toString?.() || String(pk); if (remember.checked) save(s); setConnected(s); }
        });

        const resp = await provider.connect({ onlyIfTrusted: false });
        const pk = resp?.publicKey?.toString?.() || provider?.publicKey?.toString?.() || "";
        if (remember.checked) save(pk);
        setConnected(pk);

        const sp = new URLSearchParams(location.search);
        const next = sp.get("next") || "NebulaX.html";
        location.href = next;
      }catch(e){
        setDisconnected("Connection cancelled");
      }
    });

    // Disconnect
    disconnectBtn.addEventListener("click", async () => {
      try{ await getPhantomProvider()?.disconnect?.(); }catch{}
      clear();
      setDisconnected("Disconnected");
    });
  </script>
</body>
</html>
