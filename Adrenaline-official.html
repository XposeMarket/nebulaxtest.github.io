<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>NEBULAX • Adrenaline</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
<script src="nx-theme.js"></script>
<script src="https://unpkg.com/@solana/web3.js@1.95.3/lib/index.iife.min.js"></script>
<script>
  window.NX_RPC = "https://rpc.helius.xyz/?api-key=3858d764-530d-4b75-b3df-619dc2613ff9";
</script>
<script src="assets/nx-wallet.js"></script>
<script src="assets/js/nx-search.js"></script>
<script src="adrenaline-engine.js"></script>
<script>
// Global helper functions (available for onclick handlers)
function goToCoin(mint, symbol) {
  if (!window.NX) window.NX = {};
  window.NX.currentCoin = { mint, symbol };
  window.location.href = `Coinpage-Official.html?mint=${encodeURIComponent(mint)}`;
}

async function copyAddress(address) {
  try {
    await navigator.clipboard.writeText(address);
    console.log('Address copied:', address);
  } catch (e) {
    console.error('Copy failed:', e);
  }
}

document.addEventListener("DOMContentLoaded", async () => {
  // Clear old mock data from previous versions
  try {
    localStorage.removeItem('adrenaline_migrating_tokens');
    localStorage.removeItem('adrenaline_migrated_tokens');
    localStorage.removeItem('adrenaline_new_pairs');
    sessionStorage.clear();
  } catch (e) {}

  // Sync profile picture from platform avatar or store state
  function updatePfp() {
    try {
      const pfpImg = document.getElementById('nx-pfp');
      console.log('PFP element found:', !!pfpImg);
      
      if(!pfpImg) {
        console.log('PFP element not found, retrying...');
        setTimeout(updatePfp, 500);
        return;
      }

      // First try the platform avatar key (set by store when avatar changes)
      let avatarSrc = localStorage.getItem('nx_platform_avatar');
      console.log('nx_platform_avatar:', avatarSrc);
      
      // If not found, try to get from store state
      if (!avatarSrc) {
        const storeState = JSON.parse(localStorage.getItem('nx_store_state_v3') || '{}');
        avatarSrc = storeState.profile?.avatar;
        console.log('from store state:', avatarSrc);
      }
      
      // Default to logo if nothing found
      if (!avatarSrc) {
        console.log('Using default logo');
        avatarSrc = 'NebulaX-logo.png';
      }
      
      console.log('Setting avatar src to:', avatarSrc);
      pfpImg.src = avatarSrc;
      pfpImg.onerror = () => { 
        console.log('Image failed to load, using fallback');
        pfpImg.src = 'NebulaX-logo.png'; 
      };
      pfpImg.onload = () => {
        console.log('Image loaded successfully:', avatarSrc);
      };
    } catch(e) {
      console.error('Error updating PFP:', e);
      const pfpImg = document.getElementById('nx-pfp');
      if(pfpImg) pfpImg.src = 'NebulaX-logo.png';
    }
  }
  
  // Small delay to ensure DOM is ready
  setTimeout(updatePfp, 100);

  // Listen for avatar changes from store
  window.addEventListener('nebula:avatar:changed', (e) => {
    const pfpImg = document.getElementById('nx-pfp');
    if(pfpImg && e.detail?.avatar) {
      pfpImg.src = e.detail.avatar;
      pfpImg.onerror = () => { pfpImg.src = 'NebulaX-logo.png'; };
    }
  });

  const btn = document.getElementById("wallet-btn");
  function paint(sol){
    if (!btn) return;
    if (sol == null) {
      btn.innerHTML = `<i data-lucide="wallet" class="w-3 h-3 mr-2"></i> Connect Wallet`;
    } else {
      const s = sol.toFixed(3);
      btn.innerHTML = `<i data-lucide="wallet" class="w-3 h-3 mr-2"></i> Bal: ${s} SOL`;
    }
    try { window.lucide?.createIcons?.(); } catch {}
  }
  if (window.NXWallet?.isConnected?.()) {
    try { await window.NXWallet.refreshBalance?.(true); } catch {}
    paint(window.NXWallet?.getBalance?.());
  } else {
    const prov = (window.phantom?.solana) || window.solana;
    try { await prov?.connect?.({ onlyIfTrusted: true }); } catch {}
    if (window.NXWallet?.isConnected?.()) {
      try { await window.NXWallet.refreshBalance?.(true); } catch {}
      paint(window.NXWallet?.getBalance?.());
    } else {
      paint(null);
    }
  }
  window.addEventListener("nebula:sol:changed", (e)=> paint(e.detail?.balance));
  window.addEventListener("nxwallet:connected", async ()=>{
    try { await window.NXWallet.refreshBalance?.(true); } catch {}
    paint(window.NXWallet?.getBalance?.());
  });
  window.addEventListener("nxwallet:disconnected", ()=> paint(null));
  
  // Wallet Modal Handlers
  function updateWalletDisplay(){
    const bal = window.NXWallet?.getBalance?.() || 0;
    document.getElementById('wallet-total').textContent = bal.toFixed(3) + ' SOL';
    document.getElementById('wallet-available').textContent = bal.toFixed(3) + ' SOL';
  }
  
  const wBtn = document.getElementById('wallet-btn');
  const wModal = document.getElementById('wallet-modal');
  
  wBtn?.addEventListener('click', (e)=>{
    e.stopPropagation();
    updateWalletDisplay();
    wModal.classList.remove('hidden');
  });
  
  wModal?.addEventListener('click', (e)=>{
    if(e.target === wModal) wModal.classList.add('hidden');
  });
  
  document.getElementById('dp-open')?.addEventListener('click', ()=>{
    wModal.classList.add('hidden');
    document.getElementById('deposit').classList.remove('hidden');
  });
  
  document.getElementById('wd-open')?.addEventListener('click', ()=>{
    wModal.classList.add('hidden');
    document.getElementById('withdraw').classList.remove('hidden');
  });
  
  document.getElementById('wallet-connect')?.addEventListener('click', async ()=>{
    const prov = (window.phantom?.solana) || window.solana;
    try {
      await prov?.connect?.();
    } catch(e){
      console.log('Connect cancelled');
    }
  });
  
  document.getElementById('wallet-disconnect')?.addEventListener('click', async ()=>{
    const prov = (window.phantom?.solana) || window.solana;
    try {
      await prov?.disconnect?.();
    } catch(e){
      console.log('Disconnect error');
    }
  });
  
  document.getElementById('copy-deposit')?.addEventListener('click', async ()=>{
    const addr = document.getElementById('deposit-addr').textContent;
    try {
      await navigator.clipboard.writeText(addr);
      const btn = document.getElementById('copy-deposit');
      const orig = btn.textContent;
      btn.textContent = 'Copied!';
      setTimeout(()=>{ btn.textContent = orig; }, 2000);
    } catch(e){
      console.log('Copy failed');
    }
  });
  
  document.getElementById('deposit')?.addEventListener('click', (e)=>{
    if(e.target === document.getElementById('deposit')) document.getElementById('deposit').classList.add('hidden');
  });
  
  document.getElementById('withdraw')?.addEventListener('click', (e)=>{
    if(e.target === document.getElementById('withdraw')) document.getElementById('withdraw').classList.add('hidden');
  });
  
  window.addEventListener('nebula:sol:changed', (e)=>{
    if(!wModal.classList.contains('hidden')) updateWalletDisplay();
  });

  // === NEW PAIRS PANEL RENDERING ===
  
  function formatAge(minutes) {
    if (minutes < 1) return '<1m';
    if (minutes < 60) return `${Math.floor(minutes)}m`;
    if (minutes < 1440) return `${Math.floor(minutes / 60)}h`;
    return `${Math.floor(minutes / 1440)}d`;
  }
  
  function renderNewPairs() {
    const container = document.getElementById('col-new');
    if (!container) return;

    const pairs = window.NX?.getNewPairs?.() || [];
    
    if (pairs.length === 0) {
      container.innerHTML = '<div style="padding:20px; text-align:center; color:#666;">Loading new pairs...</div>';
      return;
    }

    container.innerHTML = pairs.map(token => {
      const ageText = formatAge(token.ageMinutes);
      const mcText = formatCompact(token.mcapUsd);
      const liqText = formatCompact(token.liquidityUsd);
      const volText = formatCompact(token.vol24h);
      const pctChange = token.pct5m || token.pct1h || 0;
      const pctClass = pctChange >= 0 ? 'green' : 'red';
      const pctText = `${pctChange >= 0 ? '+' : ''}${pctChange.toFixed(1)}%`;
      const logoUrl = token.logoURI;

      return `
        <div class="row-card" data-mint="${token.mint}" onclick="goToCoin('${token.mint}', '${token.symbol}')" style="cursor:pointer;">
          <div class="row-top">
            <div class="row-left">
              <div class="token-media">
                ${logoUrl ? 
                  `<img class="token-img" src="${logoUrl}" alt="${token.symbol}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"/>
                   <div class="token-img" style="display:none; background:#333; align-items:center; justify-content:center; font-size:10px; color:#666;">${token.symbol.substring(0,2)}</div>` 
                  : 
                  `<div class="token-img" style="background:#333; display:flex; align-items:center; justify-content:center; font-size:10px; color:#666;">${token.symbol.substring(0,2)}</div>`
                }
                <div class="name-block">
                  <div class="ticker-line">
                    <div class="ticker">${token.symbol}</div>
                  </div>
                  <div class="fullname">${token.name}</div>
                </div>
              </div>
            </div>
            <div class="metrics">
              <!-- Row 1 -->
              <div class="met-row">
                <div class="metric amb"><span class="k">MC</span><span class="v">${mcText}</span></div>
                <div class="metric grn"><span class="k">Liq</span><span class="v">${liqText}</span></div>
              </div>
              <!-- Row 2 -->
              <div class="met-row">
                <div class="metric cyan"><span class="k">Vol</span><span class="v">${volText}</span></div>
                <div class="metric"><span class="k">Txns</span><span class="v">${token.txns5m || 0}</span></div>
              </div>
              <!-- Row 3 (status + copy) -->
              <div class="met-row status-line">
                <span class="chip ${pctClass}">${pctText}</span>
                <div class="metric"><span class="k">Age</span><span class="v">${ageText}</span></div>
                <span class="chip grn no-wrap">${token.dex}</span>
                <button class="copy-btn" onclick="event.stopPropagation(); copyAddress('${token.mint}')">
                  <i data-lucide="copy" class="w-3 h-3"></i><span>Copy</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
    }).join('');

    // Re-initialize lucide icons
    try { window.lucide?.createIcons?.(); } catch {}
  }

  function formatCompact(value) {
    if (!value || value === 0) return '$0';
    if (value >= 1e9) return '$' + (value / 1e9).toFixed(2) + 'B';
    if (value >= 1e6) return '$' + (value / 1e6).toFixed(2) + 'M';
    if (value >= 1e3) return '$' + (value / 1e3).toFixed(1) + 'K';
    return '$' + value.toFixed(0);
  }

  // Listen for updates from adrenaline engine
  window.addEventListener('adrenaline:newpairs:updated', () => {
    renderNewPairs();
  });

  // Render function for Migrating panel
  function renderMigratingPairs() {
    const container = document.getElementById('col-migrating');
    if (!container) return;
    
    // Get tokens that are still migrating (no real market yet)
    const migratingPairs = window.NX?.getMigratingPairs?.() || [];
    
    if (migratingPairs.length === 0) {
      container.innerHTML = '<div style="padding:20px; text-align:center; color:#666;">No tokens migrating...</div>';
      return;
    }

    container.innerHTML = migratingPairs.map(token => {
      const ageText = formatAge(token.ageMinutes);
      const mcText = formatCompact(token.mcapUsd);
      const liqText = formatCompact(token.liquidityUsd);
      const volText = formatCompact(token.vol24h);
      const pctChange = token.pct5m || token.pct1h || 0;
      const pctClass = pctChange >= 0 ? 'green' : 'red';
      const pctText = `${pctChange >= 0 ? '+' : ''}${pctChange.toFixed(1)}%`;
      const logoUrl = token.logoURI;

      return `
        <div class="row-card" data-mint="${token.mint}" onclick="goToCoin('${token.mint}', '${token.symbol}')" style="cursor:pointer;">
          <div class="row-top">
            <div class="row-left">
              <div class="token-media">
                ${logoUrl ? 
                  `<img class="token-img" src="${logoUrl}" alt="${token.symbol}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"/>
                   <div class="token-img" style="display:none; background:#333; align-items:center; justify-content:center; font-size:10px; color:#666;">${token.symbol.substring(0,2)}</div>` 
                  : 
                  `<div class="token-img" style="background:#333; display:flex; align-items:center; justify-content:center; font-size:10px; color:#666;">${token.symbol.substring(0,2)}</div>`
                }
                <div class="name-block">
                  <div class="ticker-line">
                    <div class="ticker">${token.symbol}</div>
                  </div>
                  <div class="fullname">${token.name}</div>
                </div>
              </div>
            </div>
            <div class="metrics">
              <!-- Row 1 -->
              <div class="met-row">
                <div class="metric amb"><span class="k">MC</span><span class="v">${mcText}</span></div>
                <div class="metric grn"><span class="k">Liq</span><span class="v">${liqText}</span></div>
              </div>
              <!-- Row 2 -->
              <div class="met-row">
                <div class="metric cyan"><span class="k">Vol</span><span class="v">${volText}</span></div>
                <div class="metric"><span class="k">Txns</span><span class="v">${token.txns5m || 0}</span></div>
              </div>
              <!-- Row 3 (status + copy) -->
              <div class="met-row status-line">
                <span class="chip ${pctClass}">${pctText}</span>
                <div class="metric"><span class="k">Age</span><span class="v">${ageText}</span></div>
                <span class="chip amb no-wrap">Migrating</span>
                <button class="copy-btn" onclick="event.stopPropagation(); copyAddress('${token.mint}')">
                  <i data-lucide="copy" class="w-3 h-3"></i><span>Copy</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
    }).join('');

    try { window.lucide?.createIcons?.(); } catch {}
  }

  // Render function for Migrated panel
  function renderMigratedPairs() {
    const container = document.getElementById('col-migrated');
    if (!container) return;
    
    // Get tokens that have successfully migrated (real market detected)
    const migratedPairs = window.NX?.getMigratedPairs?.() || [];
    
    if (migratedPairs.length === 0) {
      container.innerHTML = '<div style="padding:20px; text-align:center; color:#666;">No migrated tokens yet...</div>';
      return;
    }

    container.innerHTML = migratedPairs.map(token => {
      const ageText = formatAge(token.ageMinutes);
      const mcText = formatCompact(token.mcapUsd);
      const liqText = formatCompact(token.liquidityUsd);
      const volText = formatCompact(token.vol24h);
      const pctChange = token.pct5m || token.pct1h || 0;
      const pctClass = pctChange >= 0 ? 'green' : 'red';
      const pctText = `${pctChange >= 0 ? '+' : ''}${pctChange.toFixed(1)}%`;
      const logoUrl = token.logoURI;

      return `
        <div class="row-card" data-mint="${token.mint}" onclick="goToCoin('${token.mint}', '${token.symbol}')" style="cursor:pointer;">
          <div class="row-top">
            <div class="row-left">
              <div class="token-media">
                ${logoUrl ? 
                  `<img class="token-img" src="${logoUrl}" alt="${token.symbol}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"/>
                   <div class="token-img" style="display:none; background:#333; align-items:center; justify-content:center; font-size:10px; color:#666;">${token.symbol.substring(0,2)}</div>` 
                  : 
                  `<div class="token-img" style="background:#333; display:flex; align-items:center; justify-content:center; font-size:10px; color:#666;">${token.symbol.substring(0,2)}</div>`
                }
                <div class="name-block">
                  <div class="ticker-line">
                    <div class="ticker">${token.symbol}</div>
                  </div>
                  <div class="fullname">${token.name}</div>
                </div>
              </div>
            </div>
            <div class="metrics">
              <!-- Row 1 -->
              <div class="met-row">
                <div class="metric amb"><span class="k">MC</span><span class="v">${mcText}</span></div>
                <div class="metric grn"><span class="k">Liq</span><span class="v">${liqText}</span></div>
              </div>
              <!-- Row 2 -->
              <div class="met-row">
                <div class="metric cyan"><span class="k">Vol</span><span class="v">${volText}</span></div>
                <div class="metric"><span class="k">Txns</span><span class="v">${token.txns5m || 0}</span></div>
              </div>
              <!-- Row 3 (status + copy) -->
              <div class="met-row status-line">
                <span class="chip ${pctClass}">${pctText}</span>
                <div class="metric"><span class="k">Age</span><span class="v">${ageText}</span></div>
                <span class="chip grn no-wrap">Migrated</span>
                <button class="copy-btn" onclick="event.stopPropagation(); copyAddress('${token.mint}')">
                  <i data-lucide="copy" class="w-3 h-3"></i><span>Copy</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
    }).join('');

    try { window.lucide?.createIcons?.(); } catch {}
  }

  // Listen for updates from adrenaline engine
  window.addEventListener('adrenaline:newpairs:updated', () => {
    renderNewPairs();
  });

  window.addEventListener('adrenaline:migrating:updated', () => {
    renderMigratingPairs();
  });

  window.addEventListener('adrenaline:migrated:updated', () => {
    renderMigratedPairs();
  });

  // Initial render
  setTimeout(() => {
    renderNewPairs();
    renderMigratingPairs();
    renderMigratedPairs();
  }, 100);
});
</script>

<style>
  :root {
    --nx-cyan:#00e6ff; --nx-dark:#0a0d1b; --nx-dark-2:#12152a;
    --nx-border:#1e2747; --nx-text:#e0e7ff;
  }
  html[data-theme="amber"]{ --nx-cyan:#ffb020; --nx-dark:#0b0b14; --nx-dark-2:#15162a; --nx-border:#2a2647; --nx-text:#ffeccc; }
  html[data-theme="violet"]{ --nx-cyan:#b69cff; --nx-dark:#0a0a16; --nx-dark-2:#131329; --nx-border:#27224a; --nx-text:#eae4ff; }
  html[data-theme="neon"]{ --nx-cyan:#55ffda; --nx-dark:#070b12; --nx-dark-2:#0d1220; --nx-border:#1a243a; --nx-text:#dbfff7; }

  .nx-tab { padding:.4rem .6rem; border-radius:.7rem; border:1px solid transparent; font-size:.85rem; }
  .nx-tab.active { border-color:var(--nx-border); background:rgba(255,255,255,.03); color:var(--nx-cyan); }
  .nx-btn { font-size:.8rem; padding:.35rem .6rem; border-radius:.6rem; border:1px solid var(--nx-border); }
  .nx-btn-outline { font-size:.8rem; padding:.35rem .6rem; border-radius:.6rem; border:1px dashed var(--nx-border); background:transparent; }
  input::placeholder { color: #7a86a8; }
</style>
    <style>
      :root{
        --nx-cyan:#00e6ff;
        --nx-dark:#0a0d1b;
        --nx-dark-2:#12152a;
        --nx-border:#1e2747;
        --nx-text:#e0e7ff;
        --page-max: 1400px;
        --nx-amber:#ffb020;
        --nx-green:#10b981;
      }
      html,body{height:100%; background:var(--nx-dark); font-family:'Orbitron','ui-monospace','SFMono-Regular',monospace; color:var(--nx-text);}
      .page-wrap{max-width:var(--page-max); margin:18px auto; padding:0 12px;}

      .nx-panel{
        background:rgba(16,20,40,.92);
        border:1px solid var(--nx-border);
        box-shadow: inset 0 0 10px rgba(0,230,255,.18), 0 0 12px rgba(0,230,255,.08);
        backdrop-filter: blur(8px);
        border-radius: 16px;
      }
      .nx-btn{
        border-radius:14px; padding:.42rem .72rem; font-weight:700;
        transition:transform .05s ease, opacity .18s ease, box-shadow .18s ease;
        border:1px solid var(--nx-border); background:var(--nx-dark-2); color:var(--nx-text);
      }
      .nx-btn:hover{opacity:.95}
      .nx-btn:active{transform:translateY(1px)}
      .nx-btn-cyan{ background:var(--nx-cyan); color:#0b101b; border-color:#0d3540; box-shadow:0 0 10px rgba(0,230,255,.3); }
      .sm-btn{ padding:.28rem .5rem; font-size:12px; }

      .nx-input{
        width:100%; border-radius:12px; border:1px solid var(--nx-border);
        background:var(--nx-dark-2); color:var(--nx-text); padding:.55rem .7rem; outline:none; min-width:0;
      }
      .nx-input:focus{border-color:var(--nx-cyan); box-shadow:0 0 0 2px rgba(0,230,255,.14)}

      ::-webkit-scrollbar{width:10px;height:10px}
      ::-webkit-scrollbar-track{background:var(--nx-dark-2);border:1px solid #1b2450;border-radius:6px;box-shadow:inset 0 0 8px rgba(0,230,255,.12)}
      ::-webkit-scrollbar-thumb{border-radius:6px;background:var(--nx-cyan);box-shadow:0 0 8px rgba(0,230,255,.35);border:2px solid var(--nx-dark-2)}
      ::-webkit-scrollbar-thumb:hover{background:#6ff3ff}
      *{scrollbar-width:thin; scrollbar-color: var(--nx-cyan) var(--nx-dark-2)}

      .popover{position:absolute; z-index:1000; border:1px solid var(--nx-border); background:rgba(13,16,34,.98); box-shadow:0 10px 30px rgba(0,0,0,.4); border-radius:12px;}
      .search-dd{ z-index:2500; }
      .modal-fx{ position:fixed; inset:0; display:grid; place-items:center; z-index:2100; background:rgba(0,0,0,.55); padding:12px; }
      .modal-fx.hidden{ display:none !important; }

      /* Photon-style compact rows */
      .nx-list{ width:100%; }
      .row-card{ padding:12px 10px; border-bottom:1px solid #333a66; cursor:pointer; }
      .row-card:last-child{ border-bottom:0; }
/* keep this from earlier */
.row-top{
  display:flex;
  align-items:flex-start;   /* top align left & right blocks */
  gap:10px;
}

/* make the right side a 3-row stack */
.metrics{
  margin-left:auto;
  display:flex;
  flex-direction:column;    /* stack rows */
  gap:6px;
  align-items:flex-end;     /* right-align rows */
}

/* each metrics row is a single line */
.metrics .met-row{
  display:flex;
  gap:6px;
  flex-wrap:nowrap;         /* prevent chips from dropping */
}

/* reuse existing styles; just ensure status row sits nicely */
.metrics .status-line{
  margin-top:0;             /* override the default 4px top margin */
  gap:8px;                  /* a bit more breathing room */
  justify-content:flex-end; /* sit at the right with the chips */
}
      .row-left{ display:flex; flex-direction:column; align-items:flex-start; gap:2px; min-width:0; }

      /* NEW: token media (image on the left) */
      .token-media{ display:flex; align-items:center; gap:10px; min-width:0; }
      .token-img{
        width:44px; height:44px; border-radius:12px; object-fit:cover;
        border:1px solid var(--nx-border);
        box-shadow:0 0 10px rgba(0,230,255,.15), inset 0 0 6px rgba(0,0,0,.35);
        background:radial-gradient(120px 120px at 30% 30%, rgba(0,230,255,.25), rgba(255,255,255,.02));
      }

      .name-block{ display:flex; flex-direction:column; gap:2px; min-width:0; }
      .ticker-line{ display:flex; align-items:center; gap:8px; min-width:0; }
      .ticker{ font-weight:800; font-size:16px; letter-spacing:.04em; white-space:nowrap; }
      .fullname{ 
        font-size:10px; 
        color:#cfd6ff; 
        opacity:.9;
        max-width: 180px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .status-line{ display:flex; align-items:center; gap:8px; margin-top:4px; flex-wrap:wrap; }
      .chip{ display:inline-flex; align-items:center; gap:.35rem; padding:.2rem .55rem; border-radius:999px; border:1px solid var(--nx-border); background:rgba(18,21,42,.9); font-size:12px; font-weight:700; }
      .chip.green{ color:#34d399; box-shadow:0 0 6px rgba(52,211,153,.25) inset; }
      .chip.red{ color:#f87171; box-shadow:0 0 6px rgba(248,113,113,.25) inset; }
      .chip.cyan{ color:#6ff3ff; box-shadow:0 0 6px rgba(0,230,255,.25) inset; }
      .chip.amb{ color:#ffd59a; box-shadow:0 0 6px rgba(255,176,32,.25) inset; }
      .chip.no-wrap{ white-space:nowrap; }

      .copy-btn{ display:inline-flex; align-items:center; gap:6px; padding:2px 8px; border-radius:999px; border:1px solid var(--nx-border); background:rgba(20,24,48,.9); color:#9aa6dc; font-size:11px; }
      .copy-btn:hover{ color:#e0e7ff; box-shadow:0 0 6px rgba(0,230,255,.2) inset; }
      .copy-btn.copied{ border-color:var(--nx-cyan); color:#6ff3ff; }

      .metrics{ margin-left:auto; display:flex; flex-wrap:wrap; gap:6px; justify-content:flex-end; }
      .metric{ display:inline-flex; align-items:center; gap:6px; padding:4px 8px; border-radius:999px; border:1px solid var(--nx-border); background:rgba(12,16,32,.9); font-size:12px; font-weight:800; }
      .metric .k{ font-size:11px; letter-spacing:.06em; color:#9aa6dc; text-transform:uppercase; }
      .metric .v{ font-variant-numeric:tabular-nums; }
      .metric.amb .v{ color:#fbbf24; text-shadow:0 0 3px rgba(251,191,36,.35); }
      .metric.grn .v{ color:#34d399; text-shadow:0 0 3px rgba(52,211,153,.35); }
      .metric.cyan .v{ color:#6ff3ff; text-shadow:0 0 3px rgba(0,230,255,.35); }

      .sec-head{ display:flex; align-items:center; justify-content:space-between; gap:.75rem; }
      .sec-title{ font-size:1.05rem; font-weight:700; letter-spacing:.02em; display:flex; align-items:center; gap:.6rem; }
      .dot{ width:9px; height:9px; border-radius:999px; box-shadow:0 0 10px currentColor; }
      .accent-cyan{ color:var(--nx-cyan); }
      .accent-amber{ color:var(--nx-amber); }
      .accent-green{ color:var(--nx-green); }

      .themed-scroll{ overflow-y:auto; overflow-x:hidden; border-radius:12px; border:1px solid var(--nx-border); padding:2px; max-height:520px; }

      .scroll-cyan::-webkit-scrollbar-thumb{background:var(--nx-cyan);box-shadow:0 0 8px rgba(0,230,255,.35);}
      .scroll-amber::-webkit-scrollbar-thumb{background:var(--nx-amber);box-shadow:0 0 8px rgba(255,176,32,.35);}
      .scroll-green::-webkit-scrollbar-thumb{background:var(--nx-green);box-shadow:0 0 8px rgba(16,185,129,.35);}
      .scroll-cyan{scrollbar-color: var(--nx-cyan) var(--nx-dark-2);}
      .scroll-amber{scrollbar-color: var(--nx-amber) var(--nx-dark-2);}
      .scroll-green{scrollbar-color: var(--nx-green) var(--nx-dark-2);}

      .search-dd{overflow:auto;border:1px solid var(--nx-border);background:rgba(13,16,34,.98);}
      .search-head{position:sticky;top:0;padding:8px 12px;font-size:12px;letter-spacing:.08em;color:#9aa6dc;border-bottom:1px solid var(--nx-border);background:rgba(18,22,40,.96)}
      .result-item{display:flex;align-items:center;gap:10px;padding:10px 12px;border-bottom:1px solid var(--nx-border)}
      .result-item:hover{background:rgba(18,22,46,.98)}
      .ri-left{width:28px;height:28px;border-radius:10px;background:rgba(20,24,48,.9);display:flex;align-items:center;justify-content:center;border:1px solid var(--nx-border)}
      .ri-main{flex:1;min-width:0}
      .ri-pair{font-weight:800;letter-spacing:.02em}
      .ri-name{font-size:12px;color:#cfd6ff;opacity:.8;margin-top:2px}
      .ri-metrics{display:flex;gap:12px;font-size:12px;white-space:nowrap}
      .ri-metrics .lab{color:#9aa6dc;margin-right:4px}
      .row-card.highlight{box-shadow:inset 0 0 0 1px rgba(0,230,255,.35),0 0 12px rgba(0,230,255,.12);border-radius:12px}
      .modal-fx{position:fixed;inset:0;display:grid;place-items:center;z-index:2100;background:rgba(0,0,0,.55);padding:12px;}
      .modal-fx.hidden{display:none !important;}

      /* SEARCH dropdown styles (critical!) */
      #search-wrap:focus-within .nx-input{ border-color:var(--nx-cyan); box-shadow:0 0 0 2px rgba(0,230,255,.14); }
      .search-row{ display:flex; align-items:center; gap:.75rem; padding:.45rem .6rem; border-radius:10px; cursor:pointer; }
      .search-row:hover{ background: var(--nx-dark-2); }
      .search-icon{ height:2rem; width:2rem; display:flex; align-items:center; justify-content:center; border-radius:8px; background:var(--nx-dark-2); }
      .search-grid{ display:grid; grid-template-columns: 1fr auto auto auto; gap:.75rem; align-items:center; min-width:0; }
      .search-name{ min-width:0; }
      .search-name .ticker{ font-size:11px; color:#8b97c9; }
      .search-metric{ font-size:11px; color:#9fb3ff; white-space:nowrap; }
      .search-active{ outline:2px solid var(--nx-cyan); outline-offset:2px; }
    </style>
  </head>
  <body>
    <!-- Header -->
    <header class="sticky top-0 z-[1000] isolate border-b border-[var(--nx-border)] bg-[rgba(10,13,27,0.9)] backdrop-blur-sm">
      <div class="page-wrap h-7 px-1 flex items-center justify-between">
        <div class="flex items-center gap-3">
          <a href="NebulaX.html" class="flex items-center gap-2">
            <img src="NebulaX-logo.png" class="h-6 w-6 rounded-md" alt="NebulaX"/>
            <span class="font-bold tracking-wide" style="text-shadow:0 0 2px var(--nx-cyan);">NEBULAX</span>
          </a>
          <nav class="hidden sm:flex items-center gap-2 ml-2">
            <a class="nx-btn px-2 py-1 text-xs" href="NebulaX.html">Home</a>
            <a class="nx-btn px-2 py-1 text-xs" href="NewPairs-official.html">New Pairs</a>
            <a class="nx-btn px-2 py-1 text-xs" href="Trending.html">Trending</a>
            <a class="nx-btn px-2 py-1 text-xs" href="portfolio_official_v_2_fixed.html">Portfolio</a>
            <a class="nx-btn px-2 py-1 text-xs" href="Adrenaline-official.html">Adrenaline</a>
            <a class="nx-btn px-2 py-1 text-xs" href="nebula_x_store_official.html">Store</a>
            <a class="nx-btn px-2 py-1 text-xs" href="NEBX-Arcade.html">Arcade</a>
          </nav>
        </div>

  <!-- SEARCH -->
  <div id="search-wrap" class="relative w-[24rem] max-w-[50vw]">
    <input id="search-input" class="nx-input" placeholder="Search markets... /" autocomplete="off"/>
    <div id="search-dd" class="popover hidden mt-1 w-full max-h-[22rem] overflow-auto p-2"></div>
  </div>

  <!-- Right: wallet + Profile -->
  <div class="flex items-center gap-2">
    <button id="wallet-btn" class="nx-btn"><i data-lucide="wallet" class="w-3 h-3 mr-2"></i> Connect Wallet</button>
    <button id="nx-profile" class="relative w-8 h-8 rounded-xl overflow-hidden border"
            style="border-color:var(--nx-border)">
      <img id="nx-pfp" src="NebulaX-logo.png" alt="" class="absolute inset-0 w-full h-full object-cover" />
    </button>
  </div>
</div>
    </header>

    <!-- Wallet Modal -->
    <div id="wallet-modal" class="modal-fx hidden">
      <div class="nx-panel w-[380px] max-w-[90vw] p-4">
        <div class="flex items-center justify-between mb-3">
          <div class="text-lg font-semibold">Wallet</div>
          <button class="nx-btn nx-btn-cyan px-2 py-1 text-xs" onclick="document.getElementById('wallet-modal').classList.add('hidden')">Close</button>
        </div>
        <div class="grid grid-cols-2 gap-2 text-sm mb-3">
          <div class="nx-panel p-3">
            <div class="text-xs text-zinc-400 mb-1">Total Balance</div>
            <div class="font-semibold text-base" id="wallet-total">0.000 SOL</div>
          </div>
          <div class="nx-panel p-3">
            <div class="text-xs text-zinc-400 mb-1">Available</div>
            <div class="font-semibold text-base" id="wallet-available">0.000 SOL</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-2 mb-3">
          <button id="wd-open" class="nx-btn">Withdraw</button>
          <button id="dp-open" class="nx-btn nx-btn-cyan">Deposit</button>
        </div>
        <div class="grid grid-cols-2 gap-2">
          <button id="wallet-connect" class="nx-btn nx-btn-cyan">Connect</button>
          <button id="wallet-disconnect" class="nx-btn">Disconnect</button>
        </div>
      </div>
    </div>
    
    <!-- Deposit / Withdraw modals -->
    <div id="deposit" class="modal-fx hidden">
      <div class="nx-panel w-[360px] max-w-[90vw] p-3">
        <div class="flex items-center justify-between mb-2"><div class="font-semibold">Deposit</div><button class="nx-btn nx-btn-cyan px-2 py-1 text-xs" onclick="document.getElementById('deposit').classList.add('hidden')">Close</button></div>
        <div class="text-sm text-zinc-400 mb-2">Send SOL to your platform wallet address:</div>
        <div class="nx-panel p-2 text-xs break-words" id="deposit-addr">Do7AJiNrJvFVGTUCw8XvVhRGVBVLTHcBvEnfi3K68gze</div>
        <button class="nx-btn nx-btn-cyan w-full mt-3" id="copy-deposit-btn">Copy Address</button>
      </div>
    </div>
    <div id="withdraw" class="modal-fx hidden">
      <div class="nx-panel w-[360px] max-w-[90vw] p-3">
        <div class="flex items-center justify-between mb-2"><div class="font-semibold">Withdraw</div><button class="nx-btn nx-btn-cyan px-2 py-1 text-xs" onclick="document.getElementById('withdraw').classList.add('hidden')">Close</button></div>
        <div class="space-y-2">
          <input class="nx-input" placeholder="Destination SOL address"/>
          <button class="nx-btn nx-btn-cyan w-full">Withdraw SOL</button>
        </div>
      </div>
    </div>

    <!-- Deposit Modal -->
    <div id="deposit" class="modal-fx hidden">
      <div class="nx-panel w-[380px] max-w-[90vw] p-4">
        <div class="grid gap-3">
          <div style="font-size:14px;font-weight:700">Deposit SOL</div>
          <div>
            <div style="font-size:12px;color:#9aa6dc;margin-bottom:6px">Send to this address:</div>
            <div id="deposit-addr" style="font-size:11px;font-family:'Courier New',monospace;word-break:break-all;background:rgba(13,16,34,.8);padding:12px;border-radius:8px;border:1px solid var(--nx-border);margin-bottom:10px">Do7AJiNrJvFVGTUCw8XvVhRGVBVLTHcBvEnfi3K68gze</div>
            <button id="copy-deposit" class="nx-btn nx-btn-cyan w-full">Copy Address</button>
          </div>
          <button id="deposit-close" class="nx-btn" onclick="document.getElementById('deposit').classList.add('hidden')">Close</button>
        </div>
      </div>
    </div>

    <!-- Withdraw Modal -->
    <div id="withdraw" class="modal-fx hidden">
      <div class="nx-panel w-[380px] max-w-[90vw] p-4">
        <div class="grid gap-3">
          <div style="font-size:14px;font-weight:700">Withdraw SOL</div>
          <div>
            <label style="font-size:12px;color:#9aa6dc">Destination Address:</label>
            <input id="withdraw-addr" type="text" class="nx-input mt-2" placeholder="Enter Solana address"/>
          </div>
          <div>
            <label style="font-size:12px;color:#9aa6dc">Amount:</label>
            <input id="withdraw-amt" type="number" class="nx-input mt-2" placeholder="0.00" step="0.001"/>
          </div>
          <button class="nx-btn nx-btn-cyan w-full">Withdraw</button>
          <button id="withdraw-close" class="nx-btn" onclick="document.getElementById('withdraw').classList.add('hidden')">Close</button>
        </div>
      </div>
    </div>

    <div class="page-wrap">
      <!-- Main grid (3 columns) -->
      <main class="mt-3 grid grid-cols-1 md:grid-cols-3 gap-3">
        <!-- LEFT: New Pairs -->
        <section class="nx-panel p-3">
          <div class="sec-head mb-2">
            <div class="sec-title accent-cyan"><span class="dot" style="color:var(--nx-cyan)"></span> New Pairs</div>
            <button class="nx-btn sm-btn">Newest → Oldest</button>
          </div>
          <div class="themed-scroll scroll-cyan">
<div class="nx-list" id="col-new"        data-section="new">
              <!-- Live data will be inserted here by JavaScript -->
            </div>
          </div>
        </section>

        <!-- MIDDLE: Migrating / Final Stretch -->
        <section class="nx-panel p-3">
          <div class="sec-head mb-2">
            <div class="sec-title accent-amber"><span class="dot" style="color:var(--nx-amber)"></span> Migrating / Final Stretch</div>
            <button class="nx-btn sm-btn">Newest → Oldest</button>
          </div>
          <div class="themed-scroll scroll-amber">
<div class="nx-list" id="col-migrating"  data-section="migrating">
              <!-- Live data will be inserted here by JavaScript -->
            </div>
          </div>
        </section>
        <!-- RIGHT: Migrated -->
        <section class="nx-panel p-3">
          <div class="sec-head mb-2">
            <div class="sec-title accent-green"><span class="dot" style="color:var(--nx-green)"></span> Migrated</div>
            <button class="nx-btn sm-btn">Newest → Oldest</button>
          </div>
          <div class="themed-scroll scroll-green">
<div class="nx-list" id="col-migrated"   data-section="migrated">
              <!-- Live data will be inserted here by JavaScript -->
            </div>
          </div>
        </section>
      </main>

      <footer class="mt-3 mb-4">
        <div class="nx-panel px-3 py-2 text-xs flex items-center justify-between">
          <div>&copy; <span id="year"></span> NebulaX v1.0 Beta</div>
          <div>Xpose Market</div>
        </div>
      </footer>
    </div>

    <!-- Wallet Modal Popup -->
    <div id="wallet-modal" class="modal-fx hidden">
      <div class="nx-panel w-[380px] max-w-[90vw] p-4">
        <div class="flex items-center justify-between mb-3">
          <div class="text-lg font-semibold">Wallet</div>
          <button class="nx-btn nx-btn-cyan px-2 py-1 text-xs" onclick="document.getElementById('wallet-modal').classList.add('hidden')">Close</button>
        </div>
        <div class="grid grid-cols-2 gap-2 text-sm mb-3">
          <div class="nx-panel p-3">
            <div class="text-xs text-zinc-400 mb-1">Total Balance</div>
            <div class="font-semibold text-base"><span id="wallet-total">0.000</span> SOL</div>
          </div>
          <div class="nx-panel p-3">
            <div class="text-xs text-zinc-400 mb-1">Available</div>
            <div class="font-semibold text-base"><span id="wallet-available">0.000</span> SOL</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-2 mb-3">
          <button id="wd-open" class="nx-btn">Withdraw</button>
          <button id="dp-open" class="nx-btn nx-btn-cyan">Deposit</button>
        </div>
        <div class="grid grid-cols-2 gap-2">
          <button id="wallet-connect" class="nx-btn nx-btn-cyan">Connect</button>
          <button id="wallet-disconnect" class="nx-btn">Disconnect</button>
        </div>
      </div>
    </div>

    <!-- Deposit / Withdraw modals -->
    <div id="deposit" class="modal-fx hidden">
      <div class="nx-panel w-[380px] max-w-[95vw] p-3" role="dialog" aria-label="Deposit">
        <div class="flex items-center justify-between mb-2">
          <div class="font-semibold">Deposit</div>
          <button class="nx-btn nx-btn-cyan px-2 py-1 text-xs" onclick="document.getElementById('deposit').classList.add('hidden')">Close</button>
        </div>
        <div class="text-sm text-zinc-400 mb-2">Send SOL to your platform wallet address:</div>
        <div class="nx-panel p-2 text-xs break-words select-all" id="deposit-addr">Do7AJiNrJvFVGTUCw8XvVhRGVBVLTHcBvEnfi3K68gze</div>
        <div class="flex gap-2 mt-3 justify-end">
          <button class="nx-btn nx-btn-cyan" id="dp-copy">Copy Address</button>
        </div>
      </div>
    </div>
    <div id="withdraw" class="modal-fx hidden">
      <div class="nx-panel w-[380px] max-w-[95vw] p-3" role="dialog" aria-label="Withdraw">
        <div class="flex items-center justify-between mb-2">
          <div class="font-semibold">Withdraw</div>
          <button class="nx-btn nx-btn-cyan px-2 py-1 text-xs" onclick="document.getElementById('withdraw').classList.add('hidden')">Close</button>
        </div>
        <div class="space-y-2">
          <input id="wd-address" class="nx-input" placeholder="Destination SOL address"/>
          <div class="flex gap-2 items-center">
            <input id="wd-amount" class="nx-input flex-1 min-w-0" placeholder="Amount (SOL)" inputmode="decimal"/>
            <div class="flex gap-1 shrink-0">
              <button class="nx-btn sm-btn val-btn" data-target="#wd-amount" data-fill="25%">25%</button>
              <button class="nx-btn sm-btn val-btn" data-target="#wd-amount" data-fill="50%">50%</button>
              <button class="nx-btn sm-btn val-btn" data-target="#wd-amount" data-fill="MAX">MAX</button>
            </div>
          </div>
          <button class="nx-btn nx-btn-cyan w-full" id="wd-submit">Submit (mock)</button>
        </div>
      </div>
    </div>

    <!-- Icons + year + back -->
    <script>
      if (window.lucide && typeof window.lucide.createIcons==='function'){ window.lucide.createIcons(); }
      document.getElementById('year').textContent = new Date().getFullYear();
      document.getElementById('back-btn')?.addEventListener('click', (e)=>{ e.preventDefault(); history.back(); });
    </script>

    <!-- Copy buttons -->
    <script>
      document.addEventListener('click', (e)=>{
        const btn = e.target.closest('.copy-btn');
        if(!btn) return;
        e.stopPropagation();
        const addr = btn.dataset.addr || '';
        if (navigator.clipboard) navigator.clipboard.writeText(addr);
        btn.classList.add('copied');
        setTimeout(()=>btn.classList.remove('copied'), 700);
      });
    </script>

    <!-- Wallet logic -->
    <script>
      (function(){
        const fmt = n => (Math.round(n*1000)/1000).toFixed(3);
        const els = {
          bal: document.getElementById('bal-text'),
          total: document.getElementById('wallet-total'),
          avail: document.getElementById('wallet-available'),
          btn: document.getElementById('wallet-btn'),
          modal: document.getElementById('wallet-modal'),
          dp: document.getElementById('deposit'),
          wd: document.getElementById('withdraw'),
          dpCopy: document.getElementById('dp-copy'),
          dpAddr: document.getElementById('deposit-addr')
        };
        
        function updateWalletDisplay(){
          const balance = window.NXWallet?.getBalance?.();
          const sol = balance ? fmt(balance) : '0.000';
          if(els.bal) els.bal.textContent = sol;
          if(els.total) els.total.textContent = sol;
          if(els.avail) els.avail.textContent = sol;
        }
        
        updateWalletDisplay();

        els.btn?.addEventListener('click', (e)=>{ e.stopPropagation(); updateWalletDisplay(); els.modal?.classList.remove('hidden'); });
        els.modal?.addEventListener('click', (e)=>{ if(e.target===els.modal) els.modal?.classList.add('hidden'); });

        document.getElementById('dp-open')?.addEventListener('click', ()=>{ if(els.dp) els.dp.classList.remove('hidden'); els.modal?.classList.add('hidden'); });
        document.getElementById('wd-open')?.addEventListener('click', ()=>{ if(els.wd) els.wd.classList.remove('hidden'); els.modal?.classList.add('hidden'); });
        
        // Wallet connect/disconnect
        document.getElementById('wallet-connect')?.addEventListener('click',async()=>{ 
          const prov = (window.phantom?.solana) || window.solana;
          try { await prov?.connect?.(); } catch(e) { console.log('Connect cancelled'); }
        });
        document.getElementById('wallet-disconnect')?.addEventListener('click',async()=>{ 
          const prov = (window.phantom?.solana) || window.solana;
          try { await prov?.disconnect?.(); } catch(e) { console.log('Disconnect error'); }
        });
        
        // Copy address
        els.dpCopy?.addEventListener('click', ()=>{
          const addr = els.dpAddr?.textContent || '';
          navigator.clipboard.writeText(addr).then(()=>{ els.dpCopy.textContent='Copied!'; setTimeout(()=>{ els.dpCopy.textContent='Copy Address'; },2000); });
        });

        [els.dp, els.wd].forEach(m=> m?.addEventListener('click', (ev)=>{ if(ev.target===m) m.classList.add('hidden'); }));
        
        // Listen for balance changes
        window.addEventListener('nebula:sol:changed',(e)=>{ if(!els.modal?.classList.contains('hidden')) updateWalletDisplay(); });

        document.addEventListener('click', (ev)=>{
          const vb = ev.target.closest('.val-btn'); if(!vb) return;
          const input = document.querySelector(vb.getAttribute('data-target')); if(!input) return;
          const setVal = (v)=> input.value = (Math.round(v*1000)/1000).toFixed(3);
          const fill = vb.getAttribute('data-fill');
          if(fill==='MAX'){ setVal(state.avail); return; }
          if(fill.endsWith('%')){ setVal(state.avail * (parseFloat(fill)/100)); return; }
        });
      })();
    </script>

    <!-- Search handled by nx-search.js -->

    <!-- Clickable rows + CAP (30) + set height to 5 rows -->
    <script>
      // Row navigation stub (beta)
      (function(){
        const status = document.getElementById('status-text');
        function openMarket(sym){
          if(status) status.textContent = `Open ${sym} (mock)`;
          window.dispatchEvent(new CustomEvent('open-market', {detail:{symbol:sym}}));
          try{ location.hash = `#/market/${encodeURIComponent(sym)}`; }catch(e){}
        }
        document.addEventListener('click', (e)=>{
          const card = e.target.closest('.row-card');
          if(!card) return;
          if(e.target.closest('.copy-btn')) return; // ignore copy clicks
          const sym = card.getAttribute('data-symbol') || (card.id||'').replace('row-','');
          if(sym) openMarket(sym);
        });
      })();

      // Cap each column at 30 rows and mock-fill to demonstrate scroll
      (function(){
        const MAX_ROWS = 30;
        const lists = Array.from(document.querySelectorAll('.nx-list'));

        function rand(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
        function money(min,max){ return `$${rand(min,max)}M`; }
        function holders(){ return rand(1200,120000).toLocaleString(); }
        function age(){ return `${rand(1,12)}m`; }

        function tweak(clone, idx){
          clone.removeAttribute('id');

          const t = clone.querySelector('.ticker');
          if(t) t.textContent = (t.textContent || 'SYM') + '-' + (idx+1);

          const n = clone.querySelector('.fullname');
          if(n) n.textContent = (n.textContent || 'Token') + ' ' + (idx+1);

          const vs = clone.querySelectorAll('.metric .v');
          if(vs[0]) vs[0].textContent = age();           // Age
          if(vs[1]) vs[1].textContent = money(10,950);   // MC
          if(vs[2]) vs[2].textContent = money(1,90);     // Liq
          if(vs[3]) vs[3].textContent = money(5,120);    // Vol
          if(vs[4]) vs[4].textContent = holders();       // H

          // randomize chip up/down if present
          const pct = clone.querySelector('.ticker-line .chip');
          if(pct && (pct.classList.contains('green') || pct.classList.contains('red'))){
            const up = Math.random() > 0.5;
            pct.classList.toggle('green', up);
            pct.classList.toggle('red', !up);
            pct.textContent = (up?'+':'-') + (Math.random()*6).toFixed(1) + '%';
          }
          return clone;
        }

        lists.forEach(list=>{
          const rows = Array.from(list.querySelectorAll('.row-card'));
          if(rows.length===0) return;
          const template = rows[rows.length-1];
          for(let i=rows.length; i<MAX_ROWS; i++){
            list.appendChild(tweak(template.cloneNode(true), i));
          }
        });

        if (window.lucide && typeof window.lucide.createIcons==='function'){ window.lucide.createIcons(); }
      })();

      // Show exactly 5 rows (peek-free) with internal scroll if more
      (function(){
        const VISIBLE_ROWS = 4.5;
        const BUFFER_PX   = 6;
        function applyHeights(){
          document.querySelectorAll('.themed-scroll').forEach(cont=>{
            const r = cont.querySelector('.row-card');
            if(!r) return;
            const rowH = r.getBoundingClientRect().height;
            cont.style.maxHeight = Math.round(rowH * VISIBLE_ROWS + BUFFER_PX) + 'px';
            cont.style.overflowY = 'auto';
          });
        }
        applyHeights();
        window.addEventListener('resize', applyHeights);
      })();
    </script>
<script>
/** ===== NebulaX Click-to-Coin Utilities ===== */
window.NX = window.NX || {};
NX.saveSelectedCoin = function(coin){
  try { localStorage.setItem('nebula_selected_coin', JSON.stringify(coin)); } catch(e){}
};
NX.goToCoin = function(coin){
  NX.saveSelectedCoin(coin);
  const pair = coin.pair || (coin.symbol ? (coin.symbol.toUpperCase()+'/SOL') : '');
  const mint = encodeURIComponent(coin.mint || '');
  const qp = `?pair=${encodeURIComponent(pair)}${mint ? `&mint=${mint}` : ''}`;
  location.href = `Coinpage-Official.html${pair ? qp : ''}`;
};
</script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const p = new URLSearchParams(location.search);
  const EMBED = p.get('embed') === '1';

  if (EMBED) {
    // Hide page chrome when embedded
    const style = document.createElement('style');
    style.textContent = `
      header, nav, .topbar, .sidebar, .footer, .watchlist-panel, .alerts-panel { display:none !important; }
      body { background:transparent !important; }
      .page-wrap, .content, .pairs-wrap { margin:0 !important; padding:0 !important; background:transparent !important; box-shadow:none !important; }
      /* Hide brand/balance strip above the list */
      .pairs-header, .brand-row, .list-topbar, .wallet-pill, .balance-pill { display:none !important; }
    `;
    document.head.appendChild(style);
  }

  // Utility: pick a sensible scroll container
  function getScroller(){
    return document.querySelector('.pairs-wrap') ||
           document.querySelector('.content') ||
           document.scrollingElement || document.documentElement || document.body;
  }

  // Select the view (New / Migrating / Migrated) and optionally scroll the list to it
  function applyView(view, doScroll=true){
    // 1) If your page has built-in tabs, "press" the right one
    const byData = document.querySelector(`[data-view="${view}"]`);
    const byId   = document.getElementById(`${view}-tab`);
    (byData || byId)?.click?.();

    // 2) Try to scroll to the corresponding section/table if it exists
    const target =
      document.querySelector(`[data-section="${view}"]`) ||
      document.getElementById(`${view}-section`) ||
      document.getElementById(view) ||
      document.querySelector(`.${view}-section`);

    if (doScroll && target){
      const scroller = getScroller();
      const top = target.getBoundingClientRect().top + window.scrollY
                - (scroller.getBoundingClientRect?.().top || 0) - 8;
      scroller.scrollTo({ top, behavior: 'smooth' });
    }
  }

  // Initial view via query param (still supported)
  const initial = p.get('view');
  if (initial) applyView(initial, true);

  // Listen for view changes from the coin page
  window.addEventListener('message', (e) => {
    const d = e.data;
    if (!d || d.type !== 'nx-ad-view') return;
    applyView(d.view, d.scroll !== false);
  });
});
</script>
<script>
document.querySelectorAll('.row-card[data-symbol]').forEach(row=>{
  row.addEventListener('click', (e)=>{
    // Allow inner buttons (copy, alert, star) to work without navigating
    if (e.target.closest('button, .copy-btn')) return;
    const sym = row.dataset.symbol.trim().toUpperCase(); // e.g. WIF
    const mint = row.dataset.mint || '';                  // add data-mint="..." if you have it
    nxOpenCoin({ pair: `${sym}/SOL`, mint });
  });
});
</script>
<script>
function nxOpenCoin({ pair, mint = '' }) {
  const url = `Coinpage-Official.html?pair=${encodeURIComponent(pair)}&mint=${encodeURIComponent(mint)}`;
  location.href = url;
}
</script>
<script>
/* === NebulaX Core (themes, header hydrate, routing hooks) === */
(function(){
  const UserStore={
    key:'nx_user',
    state:{ wallet:null, theme:'default', pfp:{type:'builtin',url:'/pfp/default.png'} },
    load(){ try{ Object.assign(this.state, JSON.parse(localStorage.getItem(this.key)||'{}')); }catch{} },
    save(){ localStorage.setItem(this.key, JSON.stringify(this.state)); }
  };
  UserStore.load();

  const Theme={
    init(){
      const t = UserStore.state.theme || 'default';
      document.documentElement.setAttribute('data-theme', t);
      const sel = document.getElementById('nx-theme');
      if (sel) sel.value = t;
      sel?.addEventListener('change', (e)=>{
        const v=e.target.value;
        document.documentElement.setAttribute('data-theme', v);
        UserStore.state.theme=v; UserStore.save();
      });
    }
  };

  const Header={
    initActiveTab(){
      const here = location.pathname.replace(/\/+$/,'') || '/NebulaX.html';
      document.querySelectorAll('.nx-tab').forEach(a=>{
        const route = a.getAttribute('data-route');
        if (!route) return;
        if (route===here) a.classList.add('active');
        else a.classList.remove('active');
        a.addEventListener('click',(e)=>{
          // allow normal navigation
        });
      });
    },
    initSearch(){
      const input = document.getElementById('nx-search');
      const btn   = document.getElementById('nx-search-btn');
      if(!input||!btn) return;
      const go = ()=>{
        const q = (input.value||'').trim();
        if(!q) return;
        // Route to coin page convention: /Coinpage-Official.html?query=...
        location.href = `/Coinpage-Official.html?query=${encodeURIComponent(q)}`;
      };
      btn.addEventListener('click', go);
      input.addEventListener('keydown', (e)=>{ if(e.key==='Enter') go(); });
    },
    initPfp(){
      const img = document.getElementById('nx-pfp');
      if(img) img.src = (UserStore.state.pfp?.url)||'/pfp/default.png';
      const btn = document.getElementById('nx-profile');
      btn?.addEventListener('click',()=>{
        // simple MVP: cycle built-ins; later open profile modal
        const choices=['/pfp/default.png','/pfp/nx01.png','/pfp/nx02.png'];
        const idx = Math.max(0, choices.indexOf(UserStore.state.pfp?.url));
        const next = choices[(idx+1)%choices.length];
        UserStore.state.pfp={type:'builtin',url:next}; UserStore.save();
        if(img) img.src=next;
      });
    },
    initStore(){
      const a = document.getElementById('nx-store');
      if(!a) return;
      // keep as a link; if you make a modal later, hydrate here
    },
    initWallet(){
      const w = document.getElementById('nx-wallet');
      w?.addEventListener('click', ()=>{
        // hook your wallet adapter here
        alert('Connect wallet (hook your adapter)');
      });
    },
    mount(){ this.initActiveTab(); this.initSearch(); this.initPfp(); this.initStore(); this.initWallet(); }
  };

  document.addEventListener('DOMContentLoaded', ()=>{
    Theme.init();
    Header.mount();
  });
})();
</script>

  </body>
</html>

